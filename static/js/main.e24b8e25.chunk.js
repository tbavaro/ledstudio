(this.webpackJsonpledstudio=this.webpackJsonpledstudio||[]).push([[0],{27:function(e,t,i){e.exports={root:"PianoView_root__1Twcj",pressed:"PianoView_pressed__2NrJK",piano:"PianoView_piano__26Z1l",whiteKey:"PianoView_whiteKey__3Xlsl",blackKey:"PianoView_blackKey__oQHdZ"}},29:function(e,t,i){e.exports={root:"BeatControlView_root__3iwF6",button:"BeatControlView_button__2Gt_2",pressed:"BeatControlView_pressed__-CDyy"}},31:function(e,t,i){},34:function(e,t,i){"use strict";(function(e){i.d(t,"a",(function(){return l}));var n=i(13),a=i(0),r=i(1),s=i(5),o=i(8),l=function(){function t(i,n){var r=this;Object(a.a)(this,t),this.client=void 0,this.timingHelper=new o.a(20),this.channelToBufferMap=void 0,this.leds=void 0,this.client=i,this.leds=n;var s=new Map;n.forEach((function(e){var t=s.get(e.hardwareChannel);void 0===t&&(t=[],s.set(e.hardwareChannel,t)),t.push(e.hardwareIndex)})),this.channelToBufferMap=new Map;var l=new Map;s.forEach((function(t,i){t.sort((function(e,t){return e-t})),t.forEach((function(e,t){if(e<t)throw new Error("channel ".concat(i," has duplicate index ").concat(t));if(e>t)throw new Error("channel ".concat(i," skipped index before ").concat(t))}));var n=t.length;l.set(i,n);var a=new e(4+3*n).fill(0);a.writeUInt8(i,0),a.writeUInt8(0,1),a.writeUInt16BE(0,2),r.channelToBufferMap.set(i,a)}))}return Object(r.a)(t,[{key:"send",value:function(e){var t=this;this.timingHelper.addTiming((function(){var i=t.leds;if(e.length!==i.length)throw new Error("colorRow length doesn't match led row length");e.forEach((function(e,a){var r=i[a],o=t.channelToBufferMap.get(r.hardwareChannel);if(void 0===o)throw new Error("couldn't find buffer for channel");var l=s.t(e),u=Object(n.a)(l,3),c=u[0],h=u[1],d=u[2],v=4+3*r.hardwareIndex;o.writeUInt8(c,v),o.writeUInt8(h,v+1),o.writeUInt8(d,v+2)}))})),this.channelToBufferMap.forEach((function(e){t.client.sendData(e)}))}},{key:"averageSendTime",get:function(){return this.timingHelper.movingAverage}}]),t}()}).call(this,i(51).Buffer)},41:function(e,t,i){},48:function(e,t,i){},5:function(e,t,i){"use strict";i.d(t,"r",(function(){return s})),i.d(t,"t",(function(){return o})),i.d(t,"m",(function(){return l})),i.d(t,"n",(function(){return u})),i.d(t,"q",(function(){return d})),i.d(t,"s",(function(){return v})),i.d(t,"o",(function(){return f})),i.d(t,"k",(function(){return p})),i.d(t,"p",(function(){return m})),i.d(t,"l",(function(){return g})),i.d(t,"a",(function(){return w})),i.d(t,"i",(function(){return y})),i.d(t,"h",(function(){return S})),i.d(t,"e",(function(){return O})),i.d(t,"b",(function(){return j})),i.d(t,"j",(function(){return M})),i.d(t,"f",(function(){return k})),i.d(t,"d",(function(){return x})),i.d(t,"g",(function(){return C})),i.d(t,"c",(function(){return T}));var n=i(13),a=i(8),r=255;function s(e,t,i){return e<<16|t<<8|i}function o(e){return[e>>16&255,e>>8&255,255&e]}function l(e){var t=o(e),i=Object(n.a)(t,3),a=i[0],r=i[1],s=i[2];return"rgb(".concat(a,", ").concat(r,", ").concat(s,")")}function u(e){e.startsWith("#")&&(e=e.substr(1));var t=[(e=e.toLowerCase()).substr(0,2),e.substr(2,2),e.substr(4,2)];return s.apply(null,t.map((function(e){return parseInt(e,16)})))}var c=a.c,h=a.d(0,r);function d(e,t,i){return s(c(e)*r,c(t)*r,c(i)*r)}function v(e){var t=o(e);return[t[0]/r,t[1]/r,t[2]/r]}function f(e,t,i){return(e%=360)<0&&(e+=360),function(e,t,i){var n,a,o,l=e/60,u=Math.floor(l),c=l-u,h=i*(1-t),d=i*(1-t*c),v=i*(1-t*(1-c));switch(u){case 0:n=i,a=v,o=h;break;case 1:n=d,a=i,o=h;break;case 2:n=h,a=i,o=v;break;case 3:n=h,a=d,o=i;break;case 4:n=v,a=h,o=i;break;default:n=i,a=h,o=d}return s(n*r,a*r,o*r)}(e,c(t),c(i))}function p(e,t){var i=o(e),a=Object(n.a)(i,3),r=a[0],l=a[1],u=a[2],c=o(t),d=Object(n.a)(c,3),v=d[0],f=d[1],p=d[2];return s(h(r+v),h(l+f),h(u+p))}function m(e,t){var i=o(e),a=Object(n.a)(i,3),r=a[0],l=a[1],u=a[2];return s(h(Math.floor(r*t)),h(Math.floor(l*t)),h(Math.floor(u*t)))}function b(e,t,i){return p(m(e,1-i),m(t,i))}function g(e,t,i){return a.e(i,(function(n){return b(e,t,n/(i-1))}))}var w=d(0,0,0),y=d(1,1,1),S=d(1,0,0),O=d(0,1,0),j=d(0,0,1),M=d(1,1,0),k=d(1,.5,0),x=d(0,1,1),C=d(1,0,1),T=d(.5,1,0)},50:function(e,t,i){},55:function(e,t,i){},56:function(e,t,i){},57:function(e,t,i){},58:function(e,t,i){},62:function(e,t,i){"use strict";i.r(t);i(41);var n=i(32),a=i(0),r=i(1),s=i(2),o=i(3),l=i(11),u=i(8),c=function(){function e(){Object(a.a)(this,e),this.groupedNames=new Map,this.flatMap=new Map,this.cachedGroupNames=void 0}return Object(r.a)(e,[{key:"groupNames",get:function(){return void 0===this.cachedGroupNames&&(this.cachedGroupNames=Array.from(this.groupedNames.keys())),this.cachedGroupNames}},{key:"visualizationNamesInGroup",value:function(e){return Object(u.r)(this.groupedNames.get(e))}},{key:"createVisualization",value:function(e,t){return new(Object(u.r)(this.flatMap.get(e)))(t)}},{key:"add",value:function(e,t,i){if(this.cachedGroupNames=void 0,this.flatMap.has(t))throw new Error('tried to add multiple visualizations named "'.concat(t,'"'));var n=this.groupedNames.get(e);void 0===n&&(n=[],this.groupedNames.set(e,n)),n.push(t),this.flatMap.set(t,i)}}]),e}(),h=function(){function e(){Object(a.a)(this,e),this.registry=new c,this.built=!1}return Object(r.a)(e,[{key:"build",value:function(){return this.built=!0,this.registry}},{key:"add",value:function(e,t,i){if(this.built)throw new Error("can't add after registry has been built");this.registry.add(e,t,i)}}]),e}(),d=i(5),v=i(18),f=function(){function e(t,i){Object(a.a)(this,e),this.items=void 0,this.items=new Array(t);for(var n=0;n<t;++n)this.items[n]=i(n)}return Object(r.a)(e,[{key:"length",get:function(){return this.items.length}},{key:"get",value:function(e){if(e<0||e>=this.items.length)throw new Error("invalid index: ".concat(e));return this.items[e]}},{key:"getOr",value:function(e,t){return e<0||e>=this.items.length?t:this.items[e]}},{key:"set",value:function(e,t,i){if(e<0||e>=this.items.length){if(i)throw new Error("invalid index: ".concat(e))}else this.items[e]=t}},{key:"fill",value:function(e){this.items.fill(e)}},{key:"fillRange",value:function(e,t,i){for(var n=e;n<e+t;++n)this.set(n,i)}},{key:"map",value:function(t){return e.from(this.mapToArray(t))}},{key:"mapToArray",value:function(e){return this.items.map(e)}},{key:"forEach",value:function(e){this.items.forEach(e)}},{key:"toString",value:function(){return this.items.toString()}},{key:"copy",value:function(e,t,i,n){var a=t||0;if(!(a>=e.length)){var r=i||0;if(r<0)throw new Error("sourceStart is < 0");var s=Math.min(this.length,n||this.length);a<0&&(r+=-1*a,a=0);for(var o=Math.min(s-r,e.length-a),l=0;l<o;++l)e.set(a+l,this.get(r+l))}}},{key:"toArray",value:function(){return Object(v.a)(this.items)}}],[{key:"from",value:function(e){return new this(e.length,(function(t){return e[t]}))}},{key:"ofValue",value:function(e,t){return new this(e,(function(e){return t}))}}]),e}(),p=function(e){Object(s.a)(i,e);var t=Object(o.a)(i);function i(e,n){var r;Object(a.a)(this,i);var s=n||d.a;return(r=t.call(this,e,(function(e){return s}))).defaultColor=void 0,r.defaultColor=s,r}return Object(r.a)(i,[{key:"get",value:function(e){return this.getOr(e,this.defaultColor)}},{key:"add",value:function(e,t){this.set(e,d.k(this.get(e),t))}},{key:"addAll",value:function(e){var t=this;this.forEach((function(i,n){return t.set(n,d.k(i,e))}))}},{key:"multiplyAll",value:function(e){var t=this;this.forEach((function(i,n){return t.set(n,d.p(i,e))}))}},{key:"copyFancy",value:function(e,t){if(void 0===t&&(t={}),this.length!==e.length)throw new Error("expected 'this' to be a the same length as 'from'");for(var i=0;i<e.length;++i)if(void 0===t.derezAmount||Math.random()>t.derezAmount){var n=e.get(i);void 0!==t.multiplyBy&&(n=d.p(n,t.multiplyBy)),this.set(i,n)}}}]),i}(f),m=function(){function e(t,i){var n=this;if(Object(a.a)(this,e),this.ledRows=void 0,this.originalIndices=void 0,this.originalLedColors=void 0,this.originalLedMetadatas=void 0,this.cachedRowLedMetadatas=void 0,t.length!==i.length)throw new Error("ledMetadatas isn't the same length as ledColors");if(0===t.length)throw new Error("must have at least one LED");var r=[],s=t[0].rowHint,o=t[0].rowHint;t.forEach((function(e,t){var i={metadata:e,index:t},n=e.rowHint;n<s&&(s=n),n>o&&(o=n);var a=r[n];void 0===a&&(a=[],r[n]=a),a.push(i)}));for(var l=o-s+1,u=new Array(l),c=0;c<l;++c){var h=s+c;u[c]=r[h]||[]}u.forEach((function(e){e.sort((function(e,t){return e.metadata.position.x-t.metadata.position.x}))})),this.originalIndices=u.map((function(e){return e.map((function(e){return e.index}))})),this.ledRows=new f(this.originalIndices.length,(function(e){return new p(n.originalIndices[e].length)})),this.originalLedColors=i,this.originalLedMetadatas=t}return Object(r.a)(e,[{key:"rowLedMetadatas",get:function(){var e=this;return void 0===this.cachedRowLedMetadatas&&(this.cachedRowLedMetadatas=this.originalIndices.map((function(t){return t.map((function(t){return e.originalLedMetadatas[t]}))}))),this.cachedRowLedMetadatas}},{key:"finishFrame",value:function(){var e=this;this.ledRows.forEach((function(t,i){var n=e.originalIndices[i];t.forEach((function(t,i){var a=n[i];e.originalLedColors.set(a,t)}))}))}}]),e}(),b=function(){function e(t){Object(a.a)(this,e),this.value=void 0,this.value=void 0===t?NaN:t}return Object(r.a)(e,[{key:"decayLinearAmount",value:function(e){return this.value=Math.max(0,this.value-e),this.value}},{key:"decayLinearRate",value:function(e,t){return this.decayLinearAmount(e*t)}},{key:"decayExponential",value:function(e,t){return this.value*=Math.pow(.5,t/e),this.value}},{key:"bumpTo",value:function(e){(e>this.value||isNaN(this.value))&&(this.value=e)}}]),e}(),g=function(e){Object(s.a)(i,e);var t=Object(o.a)(i);function i(e,n){var r;return Object(a.a)(this,i),(r=t.call(this,n)).color=void 0,r.color=e,r}return i}(b),w=function e(t){Object(a.a)(this,e),this.config=void 0,this.ledColors=void 0,this.config=t,this.ledColors=new p(t.scene.ledMetadatas.length)},y=function(e){Object(s.a)(i,e);var t=Object(o.a)(i);function i(e){var n;return Object(a.a)(this,i),(n=t.call(this,e)).ledRows=void 0,n.ledRowMetadatas=void 0,n.rowColumnMapper=void 0,n.rowColumnMapper=new m(e.scene.ledMetadatas,n.ledColors),n.ledRowMetadatas=n.rowColumnMapper.rowLedMetadatas,n.ledRows=n.rowColumnMapper.ledRows,n}return Object(r.a)(i,[{key:"render",value:function(e){this.renderRows(e),this.rowColumnMapper.finishFrame()}}]),i}(w),S=function(e){Object(s.a)(i,e);var t=Object(o.a)(i);function i(e,n){var r;return Object(a.a)(this,i),(r=t.call(this,e)).length=void 0,r.leds=void 0,r.length=void 0===n?Math.max.apply(Math,r.ledRows.mapToArray((function(e){return e.length}))):n,r.leds=new p(r.length),r}return Object(r.a)(i,[{key:"renderRows",value:function(e){var t=this;this.renderSingleRow(e),this.ledRows.forEach((function(e){e.fill(i.UNMAPPED_LED_COLOR);var n=Math.floor((e.length-t.length)/2);t.leds.copy(e,n)}))}}]),i}(y);S.UNMAPPED_LED_COLOR=d.o(300,1,.25);var O=function(e){Object(s.a)(i,e);var t=Object(o.a)(i);function i(e,n){var r;return Object(a.a)(this,i),(r=t.call(this,e.config)).delegate=void 0,r.derez=void 0,r.delegate=e,r.derez=n,r}return Object(r.a)(i,[{key:"render",value:function(e){this.delegate.render(e),this.ledColors.copyFancy(this.delegate.ledColors,{derezAmount:this.derez})}}]),i}(w),j=d.o(210,1,.01),M=function(){function e(t){Object(a.a)(this,e),this.fallGraph=void 0,this.fallGraph=t.map((function(e,i){var n=t[i+1],a=function(e){return{rowIndex:i+1,index:e}};return e.map((function(e){if(void 0===n||0===n.length)return[];var t;for(t=0;t<n.length&&n[t].position.x<e.position.x;++t);return 0===t?[a(0)]:t>=n.length?[a(n.length-1)]:[a(t-1),a(t)]}))}))}return Object(r.a)(e,[{key:"drop",value:function(e){var t=(this.fallGraph[e.rowIndex]||[])[e.index]||[];return 0===t.length?null:t[Math.floor(Math.random()*t.length)]}}]),e}(),k=function(e){Object(s.a)(i,e);var t=Object(o.a)(i);function i(e){var n;return Object(a.a)(this,i),(n=t.call(this,e)).dropHelper=void 0,n.sparkles=void 0,n.ts=void 0,n.dropHelper=new M(n.ledRowMetadatas),n.sparkles=new Set,n.ts=e.createEasyTimeSeriesSet(),n}return Object(r.a)(i,[{key:"renderRows",value:function(e){var t=this,i=this.config.signals,n=e.elapsedSeconds,a=[];this.sparkles.forEach((function(e){if(e.millisUntilFall-=1e3*n,e.millisUntilFall<=0){var i=t.dropHelper.drop(e.address);null===i?a.push(e):(e.address=i,e.millisUntilFall=70)}})),a.forEach((function(e){return t.sparkles.delete(e)}));for(var r=i.isNewBeat?35*i.lowLevel+5:0*n,s=0;s<r;++s){var o={address:{rowIndex:0,index:Math.floor(Math.random()*this.ledRows.get(0).length)},color:d.o(200+45*Math.random(),Math.pow(Math.random(),.2),.5*Math.random()+.5),millisUntilFall:70};this.sparkles.add(o)}this.ts.red.value=r/40;var l=Math.pow(.5,n/.05);this.ledRows.forEach((function(e){return e.forEach((function(t,i){return e.set(i,d.p(t,l))}))})),this.sparkles.forEach((function(e){t.ledRows.get(e.address.rowIndex).set(e.address.index,e.color)}));var u=this.ledRows.get(0);u.forEach((function(e,t){return u.set(t,d.k(e,j))}))}}]),i}(y),x=function(e){Object(s.a)(i,e);var t=Object(o.a)(i);function i(e){return Object(a.a)(this,i),t.call(this,new k(e),.8)}return i}(O),C=i(33),T=i.n(C),E=0;function R(e){if(e>8)throw new Error("only get random palette's of size 8 or less");var t=["cb-Accent","cb-Blues","cb-BrBG","mpn65","cb-BuGn","cb-Dark2","cb-GnBu","rainbow","cb-Greens","cb-OrRd","sol-accent","cb-PRGn","cb-PuBuGn","tol-dv","cb-PuOr","cb-PuRd","cb-RdBu","tol-rainbow","cb-RdYlGn","cb-Reds","cb-YlGnBu","cb-YlOrRd"],i=t[E];return console.log(i),E=(E+1)%t.length,T()(i,e).map(d.n)}var D=function(e){Object(s.a)(i,e);var t=Object(o.a)(i);function i(e){var n;return Object(a.a)(this,i),(n=t.call(this,e)).regularPalette=[],n.dropPalette=[],n.wingDashPaires=void 0,n.wingDashPairRatioes=void 0,n.ezTS=void 0,n.signals=void 0,n.colorOffset=void 0,n.lastPaletteSwap=-1,n.swapPalettes(),n.colorOffset=n.colorOffset=Math.floor(3*Math.random()+1),n.wingDashPaires=[0,0,0,0].map((function(e){return Math.round(3*Math.random())+3})),n.wingDashPairRatioes=[.66,.34,.34,.66],n.ezTS=e.createEasyTimeSeriesSet(),n.signals=e.signals,n}return Object(r.a)(i,[{key:"renderRows",value:function(e){var t=this;Date.now()-this.lastPaletteSwap>3e4&&this.signals.soundsLikeStrongBeat&&this.swapPalettes(),this.ledRows.forEach((function(e){return e.fill(d.a)})),this.ezTS.white.value=this.signals.beatsWithBeats.sum((function(e){return e}))/8,this.ezTS.red.value=this.signals.audioValues.lowRMSZScore20/4,this.ezTS.green.value=this.signals.lowLevel,this.ezTS.orange.value=4*this.signals.audioValues.lowRMSEMA20;var i=this.signals.beatsSinceDrop<16;this.ledRows.forEach((function(e,n){for(var a=e.length/2,r=t.wingDashPaires[n],s=Math.floor(a/r),o=Math.floor((a-s*r)/2),l=0;l<r;++l){var u=Math.round(o+l*s),c=Math.round(s*t.wingDashPairRatioes[n]),h=V(n%2===0?t.signals.lowLevel:t.signals.highLevel),d=i?0:n+l+t.colorOffset,v=t.randomColor(d,i),f=t.randomColor(d,i);t.renderDash(u,c,h,v,f,e);var p=u+c,m=s-c,b=V(n%2===1?t.signals.lowLevel:t.signals.highLevel),g=i?1:n+12997217*l+t.colorOffset,w=t.randomColor(g,i),y=t.randomColor(g,i);t.renderDash(p,m,b,w,y,e)}}))}},{key:"renderDash",value:function(e,t,i,n,a,r){for(var s=e+t/2,o=Math.floor(s-t/2),l=Math.ceil(s+t/2),c=i*t,h=o;h<=l;++h){var v=Object(u.c)(c-Math.abs(h-s));r.add(h,d.p(n,v)),r.add(r.length-h,d.p(a,v))}}},{key:"randomColor",value:function(e,t){return t?this.dropPalette[e]:this.regularPalette[e%this.regularPalette.length]}},{key:"swapPalettes",value:function(){this.regularPalette=R(8),this.dropPalette=[this.regularPalette[2],this.regularPalette[7]],this.lastPaletteSwap=Date.now()}}]),i}(y);function V(e){return.75*e+.05}var I=256,N=function(e){Object(s.a)(i,e);var t=Object(o.a)(i);function i(e){var n;Object(a.a)(this,i),(n=t.call(this,e)).analyser=void 0,n.buffer=void 0,n.bucketLocations=[],n.prevBeatNumber=void 0,n.values=void 0;var r=e.audioSource||(new AudioContext).createGain(),s=r.context,o=new AnalyserNode(s);return o.fftSize=512,o.smoothingTimeConstant=.2,r.connect(o),n.analyser=o,n.buffer=new Uint8Array(n.analyser.frequencyBinCount),n.values=Object(u.e)(I,(function(e){return new b(0)})),n.shuffleLocations(),n}return Object(r.a)(i,[{key:"shuffleLocations",value:function(){this.bucketLocations=[];for(var e=0;e<256;++e){var t=void 0;do{t=Math.floor(Math.random()*this.ledColors.length)}while(this.bucketLocations.includes(t));this.bucketLocations[e]=t}}},{key:"render",value:function(e){var t=this,i=this.analyser;if(null!==i){var n=e.beatController.beatNumber();n!==this.prevBeatNumber&&(this.shuffleLocations(),this.prevBeatNumber=n),i.getByteFrequencyData(this.buffer);for(var a=0;a<I;++a){var r=this.buffer[a]/255,s=Math.pow(Object(u.c)((r-.1)/.6),2);this.values[a].decayLinearRate(4,e.elapsedSeconds),this.values[a].bumpTo(s)}this.ledColors.multiplyAll(.7),this.values.forEach((function(e,i){var n=i/I,a=t.bucketLocations[i],r=360-i/I*240,s=1-Object(u.c)((e.value-.7)/.9),o=Object(u.c)(e.value/.7)*Math.pow(1-n,.25),l=d.o(r,s,o);t.ledColors.set(a,l)})),e.setFrameHeatmapValues(this.values.map((function(e){return e.value})))}}}]),i}(w),L=i(17);function z(){return Math.floor(360*Math.random())}var A=function(e){Object(s.a)(i,e);var t=Object(o.a)(i);function i(e){var n;Object(a.a)(this,i),(n=t.call(this,e)).info=new Array,n.sparkles=new Array,n.time=0,n.keyToHue=new Array;for(var r=0;r<n.leds.length;++r)n.keyToHue[r]=z();return n}return Object(r.a)(i,[{key:"renderSingleRow",value:function(e){var t=this,i=e.elapsedMillis,n=e.pianoState;this.time+=i,this.info=this.info.filter((function(e){return t.time-e.time<1500}));var a,r=0,s=Object(L.a)(n.changedKeys);try{for(s.s();!(a=s.n()).done;){var o=a.value;n.keys[o]&&(r+=n.keyVelocities[o])}}catch(C){s.e(C)}finally{s.f()}r>0&&this.info.push({time:this.time,velocity:Math.min(1,r),randomHue:z()}),this.leds.fill(d.a);var l,u=Object(L.a)(this.info);try{for(u.s();!(l=u.n()).done;){for(var c=l.value,h=this.time-c.time,v=Math.round(h/1e3*(this.leds.length/2)),f=v+this.leds.length/2,p=1,m=f;m>=this.leds.length/2&&p>0;--m){var b=d.o(c.randomHue,1,p);p-=.02/c.velocity,m<this.leds.length&&this.leds.add(m,b)}var g=this.leds.length/2-v;p=1;for(var w=g;w<=this.leds.length/2&&p>0;++w){var y=d.o(c.randomHue,1,p);p-=.02/c.velocity,this.leds.add(w,y)}}}catch(C){u.e(C)}finally{u.f()}this.sparkles=this.sparkles.filter((function(e){return e.value>0}));for(var S=function(e){var i=d.s(t.leds.get(e)),n=Math.max(i[0],i[1],i[2]);n>0&&Math.random()<.02&&t.sparkles.findIndex((function(t){return t.led===e}))<0&&t.sparkles.push({value:n,led:e})},O=0;O<this.leds.length;++O)S(O);var j,M=Object(L.a)(this.sparkles);try{for(M.s();!(j=M.n()).done;){var k=j.value,x=d.o(z(),.25*Math.random(),k.value);this.leds.add(k.led,x),k.value-=.03}}catch(C){M.e(C)}finally{M.f()}}}]),i}(S);function B(e,t,i,n,a){e<i||e>n||(a(e,0),[-1,1].forEach((function(r){for(var s=1,o=e+s*r*t;o>=i&&o<=n;)a(o,s),s++,o+=r*t})))}var P=function(e){Object(s.a)(i,e);var t=Object(o.a)(i);function i(e){var n;Object(a.a)(this,i),(n=t.call(this,e)).pressedKeyColors=new Map,n.fadeFactors=void 0,n.nativeRows=void 0;var r=n.ledRows.mapToArray((function(e){return e.length})),s=Math.floor(r.length/2);return n.fadeFactors=r.map((function(e,t){return Math.pow(.4,Math.abs(t-s))})),n.nativeRows=r.map((function(e){return new p(e)})),n}return Object(r.a)(i,[{key:"renderRows",value:function(e){var t=this,i=e.elapsedSeconds,n=e.pianoState;this.pressedKeyColors.forEach((function(e,a){n.keys[a]||(e.brightness*=1-3*i,e.brightness<.01&&t.pressedKeyColors.delete(a))})),n.changedKeys.forEach((function(e){if(n.keys[e]){var i=u.c(n.keyVelocities[e]/.6);t.pressedKeyColors.set(e,{initialColor:d.o(10*e,1,1),brightness:i})}}));var a=new p(88);this.pressedKeyColors.forEach((function(e,t){B(t,18,-18,106,(function(t,i){var n=e.brightness*Math.pow(1-.7,i);B(t,1,-18,106,(function(t,i){if(t>=0&&t<a.length){var r=n*Math.pow(.8,i);if(r>.01){var s=d.p(e.initialColor,r);a.add(t,s)}}}))}))})),this.nativeRows.forEach((function(e,i){for(var n=new p(e.length),r=0;r<n.length;++r)n.set(r,a.get(Math.floor(r/n.length*a.length)));e.copyFancy(n,{derezAmount:.75,multiplyBy:t.fadeFactors[i]});var s=t.ledRows.get(i);e.copy(s)}))}}]),i}(y),F=function(){function e(t){Object(a.a)(this,e),this.alpha=void 0,this.emaValue=null,this.emvValue=null,this.zScoreValue=null,this.alpha=t}return Object(r.a)(e,[{key:"update",value:function(e){if(null==this.emaValue||null==this.emvValue||null==this.zScoreValue)return this.emaValue=e,this.emvValue=0,void(this.zScoreValue=0);var t=e-this.emaValue,i=this.alpha*t;this.emaValue=i+this.emaValue,this.emvValue=(1-this.alpha)*(this.emvValue+t*i);var n=Math.sqrt(this.emv);this.zScoreValue=(e-this.ema)/n}},{key:"ema",get:function(){return null!=this.emaValue?this.emaValue:1}},{key:"emv",get:function(){return null!=this.emvValue?this.emvValue:0}},{key:"zScore",get:function(){return null!=this.zScoreValue?this.zScoreValue:0}}]),e}();var H=function(){function e(t){Object(a.a)(this,e),this.maxSize=void 0,this.values=void 0,this.nextIndex=void 0,this.sizeUnsafe=void 0,this.maxSize=t,this.values=new Array(t).fill(void 0),this.nextIndex=0,this.sizeUnsafe=0}return Object(r.a)(e,[{key:"size",get:function(){return this.sizeUnsafe}},{key:"push",value:function(e){var t=this.nextIndex;this.nextIndex=(this.nextIndex+1)%this.maxSize;var i=this.values[t];return this.sizeUnsafe<this.maxSize&&(this.sizeUnsafe+=1),this.values[t]=e,i}},{key:"forEach",value:function(e){var t=this.nextIndex-this.sizeUnsafe;t<0&&(t+=this.maxSize);for(var i=0;i<this.sizeUnsafe;++i)e(this.values[t]),(t+=1)>=this.maxSize&&(t=0)}},{key:"reduce",value:function(e,t){var i=t;return this.forEach((function(t){return i=e(i,t)})),i}},{key:"sum",value:function(e){var t=0;return this.forEach((function(i){return t+=e(i)})),t}}]),e}(),U=function(){function e(t,i){Object(a.a)(this,e),this.currentSamples=void 0,this.analyser=void 0,this.cacheIsDirty=!0,this.cachedMaxAmplitude=0,this.cachedRMSAmplitude=0,this.cachedRmsEma3=new F(.015),this.cachedRmsEma20=new F(.0023),this.currentSamples=new Float32Array(i);var n=t.context;this.analyser=n.createAnalyser(),this.analyser.fftSize=i,t.connect(this.analyser)}return Object(r.a)(e,[{key:"listen",value:function(){this.analyser.connect(this.analyser.context.destination)}},{key:"sample",value:function(){return this.analyser.getFloatTimeDomainData(this.currentSamples),this.cacheIsDirty=!0,this.currentSamples}},{key:"updateCachedValuesIfNeeded",value:function(){if(this.cacheIsDirty){var e=this.currentSamples,t=0,i=0;e.forEach((function(e){var n=Math.abs(e);n>t&&(t=n),i+=e*e})),this.cachedMaxAmplitude=t,this.cachedRMSAmplitude=Math.sqrt(i/e.length),this.cachedRmsEma3.update(this.cachedRMSAmplitude),this.cachedRmsEma20.update(this.cachedRMSAmplitude),this.cacheIsDirty=!1}}},{key:"currentMaxAmplitude",get:function(){return this.updateCachedValuesIfNeeded(),this.cachedMaxAmplitude}},{key:"currentRMSAmplitude",get:function(){return this.updateCachedValuesIfNeeded(),this.cachedRMSAmplitude}},{key:"currentRmsEma3",get:function(){return this.updateCachedValuesIfNeeded(),this.cachedRmsEma3}},{key:"currentRmsEma20",get:function(){return this.updateCachedValuesIfNeeded(),this.cachedRmsEma20}}]),e}();function G(e){var t=e.context,i=[],n=function(){var n,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(a){var r=new BiquadFilterNode(t,{type:a});e.connect(r),n=r}else n=e;var s=new U(n,1024);return i.push(s),s};return{direct:n(),low:n("lowpass"),high:n("highpass"),sampleAll:function(){return i.forEach((function(e){return e.sample()}))}}}var q=U,W=function(){function e(t){var i=this;Object(a.a)(this,e),this.samplers=void 0,this.unfilteredSampler=void 0,this.lowSampler=void 0,this.highSampler=void 0,this.reusedValues=void 0;var n=t.context;this.samplers=[];var r=function(e){var n;if(e){var a=e();t.connect(a),n=a}else n=t;var r=new q(n,1024);return i.samplers.push(r),r};this.unfilteredSampler=r(),this.lowSampler=r((function(){return new BiquadFilterNode(n,{type:"lowpass"})})),this.highSampler=r((function(){return new BiquadFilterNode(n,{type:"highpass"})})),this.reusedValues={samples:this.unfilteredSampler.currentSamples,unfilteredRMS:0,unfilteredRMSEMA3:0,unfilteredRMSZScore3:0,unfilteredRMSEMA20:0,unfilteredRMSZScore20:0,unfilteredPeak:0,lowRMS:0,lowRMSEMA3:0,lowRMSZScore3:0,lowRMSEMA20:0,lowRMSZScore20:0,lowPeak:0,highRMS:0,highRMSEMA3:0,highRMSZScore3:0,highRMSEMA20:0,highRMSZScore20:0,highPeak:0}}return Object(r.a)(e,[{key:"getValues",value:function(){this.samplers.forEach((function(e){return e.sample()}));var e=this.reusedValues;return e.samples=this.unfilteredSampler.currentSamples,e.unfilteredRMS=this.unfilteredSampler.currentRMSAmplitude,e.unfilteredRMSZScore3=this.unfilteredSampler.currentRmsEma3.zScore,e.unfilteredRMSEMA3=this.unfilteredSampler.currentRmsEma3.ema,e.unfilteredRMSZScore20=this.unfilteredSampler.currentRmsEma20.zScore,e.unfilteredRMSEMA20=this.unfilteredSampler.currentRmsEma20.ema,e.unfilteredPeak=this.unfilteredSampler.currentMaxAmplitude,e.lowRMS=this.lowSampler.currentRMSAmplitude,e.lowRMSZScore3=this.lowSampler.currentRmsEma3.zScore,e.lowRMSEMA3=this.unfilteredSampler.currentRmsEma3.ema,e.lowRMSZScore20=this.lowSampler.currentRmsEma20.zScore,e.lowRMSEMA20=this.unfilteredSampler.currentRmsEma20.ema,e.lowPeak=this.lowSampler.currentMaxAmplitude,e.highRMS=this.highSampler.currentRMSAmplitude,e.highRMSEMA3=this.highSampler.currentRmsEma3.ema,e.highRMSZScore3=this.highSampler.currentRmsEma3.zScore,e.highRMSEMA20=this.highSampler.currentRmsEma20.ema,e.highRMSZScore20=this.highSampler.currentRmsEma20.zScore,e.highPeak=this.highSampler.currentMaxAmplitude,e}}]),e}(),_=function(){function e(t){Object(a.a)(this,e),this.v=new b,this.minThreshold=void 0,this.maxThreshold=void 0,this.halfLife=void 0,this.vEMA=new F(.0023),this.minThreshold=Object(u.q)(t.minThreshold,0),this.maxThreshold=Object(u.q)(t.maxThreshold,1),this.halfLife=e.HALF_LIFE_MIN}return Object(r.a)(e,[{key:"processValue",value:function(t,i){var n=Object(u.c)((t-this.minThreshold)/(this.maxThreshold-this.minThreshold));if(this.v.decayExponential(this.halfLife,i/1e3),this.v.bumpTo(n),!isNaN(this.value)){this.vEMA.update(this.value);var a=this.vEMA.ema-.25;this.halfLife-=Object(u.b)(-.0125,.0125,.2*a),this.halfLife=Object(u.b)(e.HALF_LIFE_MIN,1,this.halfLife)}}},{key:"value",get:function(){return this.v.value}}]),e}();_.HALF_LIFE_MIN=.5;var K=function(){function e(t){Object(a.a)(this,e),this.audioHelper=void 0,this.lowDecaySignal=void 0,this.highDecaySignal=void 0,this.isDropValue=!1,this.soundsLikeStrongBeatValue=!1,this.soundsLikeNewBeatValue=!1,this.lastBeat=-1e7,this.dropBeat=-1e7,this.beatSinceDropValue=-1e7,this.prevBeatNum=-1,this.isNewBeat=!1,this.beatOnBeat=!1,this.beatsWithBeats=new H(8),this.audioValues=void 0,this.audioHelper=new W(t),this.audioValues=this.audioHelper.getValues(),this.lowDecaySignal=new _({minThreshold:.3,maxThreshold:5}),this.highDecaySignal=new _({minThreshold:.3,maxThreshold:5})}return Object(r.a)(e,[{key:"update",value:function(e,t){this.audioValues=this.audioHelper.getValues(),this.lowDecaySignal.processValue(this.audioValues.lowRMSZScore20,e),this.highDecaySignal.processValue(this.audioValues.highRMSZScore20,e);var i=t.beatNumber(),n=t.timeSinceLastBeat()<.1||t.progressToNextBeat()>.95;this.audioValues.lowRMSZScore3>4&&n?(this.dropBeat=i,this.isDropValue=!0,this.lowDecaySignal.halfLife=_.HALF_LIFE_MIN,this.highDecaySignal.halfLife=_.HALF_LIFE_MIN):this.isDropValue=!1,this.soundsLikeDance&&(this.lowDecaySignal.halfLife=_.HALF_LIFE_MIN),this.beatsSinceDrop<16&&(this.lowDecaySignal.halfLife=_.HALF_LIFE_MIN),this.audioValues.lowRMSZScore3>2&&n?this.soundsLikeStrongBeatValue=!0:this.soundsLikeStrongBeatValue=!1,this.beatSinceDropValue=i-this.dropBeat,this.soundsLikeNewBeatValue=i!==this.lastBeat,this.soundsLikeNewBeat&&(this.beatsWithBeats.push(this.beatOnBeat?1:0),this.beatOnBeat=!1),this.audioValues.lowRMSZScore3>1.2&&n&&(this.beatOnBeat=!0),this.lastBeat=i;var a=t.beatNumber();this.isNewBeat=this.prevBeatNum!==a,this.prevBeatNum=a}},{key:"lowLevel",get:function(){return this.lowDecaySignal.value}},{key:"highLevel",get:function(){return this.highDecaySignal.value}},{key:"soundsLikeDrop",get:function(){return this.isDropValue}},{key:"soundsLikeStrongBeat",get:function(){return this.soundsLikeStrongBeatValue}},{key:"beatsSinceDrop",get:function(){return this.beatSinceDropValue}},{key:"soundsLikeNewBeat",get:function(){return this.soundsLikeNewBeatValue}},{key:"soundsLikeDance",get:function(){return this.beatsWithBeats.sum((function(e){return e}))>6}}]),e}(),Z=function(){function e(t){Object(a.a)(this,e),this.fallGraph=void 0,this.fallGraph=t.map((function(e,i){var n=t[i+1],a=function(e){return{rowIndex:i+1,index:e}};return e.map((function(e){if(void 0===n||0===n.length)return[];var t;for(t=0;t<n.length&&n[t].position.x<e.position.x;++t);return 0===t?[a(0)]:t>=n.length?[a(n.length-1)]:[a(t-1),a(t)]}))}))}return Object(r.a)(e,[{key:"drop",value:function(e){var t=(this.fallGraph[e.rowIndex]||[])[e.index]||[];return 0===t.length?null:t[Math.floor(Math.random()*t.length)]}}]),e}(),Y=function(e){Object(s.a)(i,e);var t=Object(o.a)(i);function i(e){var n;return Object(a.a)(this,i),(n=t.call(this,e)).dropHelper=void 0,n.sparkles=void 0,n.numSparklesRemainder=0,n.signals=void 0,n.dropHelper=new Z(n.ledRowMetadatas),n.sparkles=new Set,n.signals=e.audioSource?new K(e.audioSource):void 0,n}return Object(r.a)(i,[{key:"renderRows",value:function(e){var t=this;if(void 0!==this.signals){var i=e.elapsedSeconds,n=e.beatController,a=Date.now()/1e3;this.signals.update(i/1e3,n);var r=[];this.sparkles.forEach((function(e){if(e.millisUntilFall-=1e3*i,e.millisUntilFall<=0){var n=t.dropHelper.drop(e.address);null===n?r.push(e):(e.address=n,e.millisUntilFall=100,e.color=d.p(e.color,1-e.fadeRate))}})),r.forEach((function(e){return t.sparkles.delete(e)}));var s=.75;this.signals.beatsSinceDrop<16&&(s=2*(n.progressToNextBeat()-.5)*.8);for(var o=200+800*(this.signals.audioValues.unfilteredRMS-.25),l=this.numSparklesRemainder+i*o;l>=1;){var u=Math.floor(Math.random()*this.ledRows.get(0).length),c={address:{rowIndex:0,index:u},color:d.o(u+90*a,Math.pow(Math.random(),.2),.5*Math.random()+.5),millisUntilFall:100,fadeRate:Math.pow(Math.random(),.2)};this.sparkles.add(c),l-=1}this.numSparklesRemainder=l;var h=Math.pow(.5,i/.2);this.ledRows.forEach((function(e){return e.forEach((function(t,i){return e.set(i,d.p(t,h))}))})),this.sparkles.forEach((function(e){t.ledRows.get(e.address.rowIndex).add(e.address.index,d.p(e.color,s))}))}}}]),i}(y),X=function(){function e(t,i){Object(a.a)(this,e),this.value=void 0,this.decayRate=void 0,this.value=t,this.decayRate=i}return Object(r.a)(e,[{key:"decay",value:function(e){return this.value=Math.max(0,this.value-e*this.decayRate),this.value}},{key:"bump",value:function(e){return this.value=Math.max(e,this.value),this.value}}]),e}(),J=function(e){Object(s.a)(i,e);var t=Object(o.a)(i);function i(e){var n;return Object(a.a)(this,i),(n=t.call(this,e)).numLedsRemainder=0,n.flashBrightness=new X(0,8),n.lowTS=void 0,n.highTS=void 0,n.flashBrightnessTS=void 0,n.signals=void 0,n.signals=e.signals,n.lowTS=e.createTimeSeries({color:d.b}),n.highTS=e.createTimeSeries({color:d.h}),n.flashBrightnessTS=e.createTimeSeries(),n}return Object(r.a)(i,[{key:"render",value:function(e){var t=e.elapsedSeconds;this.flashBrightness.decay(t);this.flashBrightness.bump(Object(u.c)(1.25*Math.pow(this.signals.audioValues.lowRMSZScore20/2,5)-.25));var i=this.signals.beatsSinceDrop<16||this.signals.soundsLikeDance?.2:1,n=Math.pow(.5,t/i);this.ledColors.multiplyAll(n);var a=d.p(d.b,this.flashBrightness.value);this.ledColors.addAll(a);for(var r=this.numLedsRemainder+0*t;r>=1;){var s=Math.floor(Math.random()*this.ledColors.length);this.ledColors.set(s,d.i),r-=1}this.numLedsRemainder=r,this.flashBrightnessTS.value=this.flashBrightness.value,this.lowTS.value=this.signals.audioValues.lowRMS,this.highTS.value=this.signals.audioValues.highRMS}}]),i}(w),Q=i(13),$=i(4);function ee(e){var t=NaN,i=NaN;e.length>0&&(t=e[0].x,i=e[0].y);var n,a=t,r=t,s=i,o=i,l=Object(L.a)(e);try{for(l.s();!(n=l.n()).done;){var u=n.value;u.x<a&&(a=u.x),u.x>r&&(r=u.x),u.y<s&&(s=u.y),u.y>o&&(o=u.y)}}catch(c){l.e(c)}finally{l.f()}return{minX:a,maxX:r,minY:s,maxY:o}}var te=.05;function ie(e,t,i){if(0===e.length)return null;var n=0,a=t.distanceTo(e[0]);return e.forEach((function(e,i){var r=t.distanceTo(e);r<a&&(a=r,n=i)})),void 0===i||a<=i?n:null}var ne,ae=function(){function e(t){Object(a.a)(this,e),this.pixelsForPoint=void 0,this.height=void 0,this.width=void 0,this.colors=void 0,this.valuesR=void 0,this.valuesG=void 0,this.valuesB=void 0,this.ledMapper=void 0,this.pixelsForPoint=t.points.map((function(e){return[]}));for(var i=t.points.map((function(e){return 0})),n=new $.wb(0,0),r=0;n.y<t.height;){for(n.x=0;n.x<t.width;){var s=ie(t.points,n,t.maxDistance);null!==s&&(this.pixelsForPoint[s].push(r),++i[s]),++r,++n.x}++n.y}var o=this.pixelsForPoint[0].length,l=o;this.pixelsForPoint.forEach((function(e){var t=e.length;t<o?o=t:t>l&&(l=t)})),this.colors=new p(t.points.length),this.valuesR=new Array(t.points.length).fill(0),this.valuesG=new Array(t.points.length).fill(0),this.valuesB=new Array(t.points.length).fill(0),this.width=t.width,this.height=t.height,this.ledMapper=t.ledMapper}return Object(r.a)(e,[{key:"colorsFromCanvas",value:function(e,t){var i=this;if(e.height!==this.height||e.width!==this.width)throw new Error("canvas isn't the right size");var n=t.getImageData(0,0,e.width,e.height);return this.valuesR.fill(0),this.valuesG.fill(0),this.valuesB.fill(0),this.pixelsForPoint.forEach((function(e,t){var a,r=0,s=0,o=0,l=Object(L.a)(e);try{for(l.s();!(a=l.n()).done;){var u=a.value;r+=n.data[4*u],s+=n.data[4*u+1],o+=n.data[4*u+2]}}catch(v){l.e(v)}finally{l.f()}var c=e.length,h=d.r(Math.round(r/c),Math.round(s/c),Math.round(o/c));i.colors.set(t,h)})),this.colors}},{key:"drawColorsOnCanvas",value:function(e,t){if(e.height!==this.height||e.width!==this.width)throw new Error("canvas isn't the right size");var i=e.getContext("2d");if(!i)throw new Error("can't get canvas context");i.fillStyle="black",i.fillRect(0,0,e.width,e.height);var n=new ImageData(e.width,e.height);this.pixelsForPoint.forEach((function(e,i){var a=d.t(t.get(i)),r=Object(Q.a)(a,3),s=r[0],o=r[1],l=r[2];e.forEach((function(e){n.data[4*e]=s,n.data[4*e+1]=o,n.data[4*e+2]=l,n.data[4*e+3]=255}))})),i.putImageData(n,0,0)}},{key:"drawDebugMapOnCanvas",value:function(e){for(var t=new p(this.pixelsForPoint.length),i=0;i<this.pixelsForPoint.length;++i)t.set(i,d.o(360*Math.random(),.7,.5*Math.random()+.5));this.drawColorsOnCanvas(e,t)}}]),e}();function re(e){if(ne&&ne.scene===e)return ne;var t,i,n=e.ledMetadatas,a=n.map((function(e){return e.position})).map((function(e){return new $.wb(e.x,e.y)})),r=ee(a),s=r.maxX-r.minX+.1,o=r.maxY-r.minY+.1,l=e.voronoiMaxDimension;s>o?(t=l,i=Math.ceil(l/s*o)):(i=l,t=Math.ceil(l/o*s));var u=function(e,n){void 0===n&&(n=new $.wb);var a=(1-(e.x-r.minX+te)/s)*(t-1),l=(1-(e.y-r.minY+te)/o)*(i-1);return n.set(a,l),n},c=a.map((function(e){return u(e)})),h=te*(t/s),d=new $.wb,v=new ae({points:c,width:t,height:i,maxDistance:h,ledMapper:function(e,t){return u(function(e,t){return void 0===t&&(t=new $.wb),t.set(e.x,e.y),t}(e.position,d),t)}});return ne={scene:e,helper:v,canvasWidth:t,canvasHeight:i}}var se=function(e){Object(s.a)(i,e);var t=Object(o.a)(i);function i(e){var n;Object(a.a)(this,i),(n=t.call(this,e)).helper=void 0,n.canvas=void 0,n.canvasContext=void 0,n.allLedMetadatas=void 0;var r=re(e.scene);n.helper=r.helper,n.canvas=function(e,t){var i=document.createElement("canvas");return i.style.backgroundColor="black",i.width=e,i.height=t,i}(r.canvasWidth,r.canvasHeight);var s=n.canvas.getContext("2d");if(!s)throw new Error("can't use canvas");return n.canvasContext=s,e.setExtraDisplay(n.canvas),n.allLedMetadatas=e.scene.ledMetadatas,n}return Object(r.a)(i,[{key:"render",value:function(e){var t=this;this.renderToCanvas(e),this.helper.colorsFromCanvas(this.canvas,this.canvasContext).forEach((function(e,i){return t.ledColors.set(i,e)}))}},{key:"mapTo2d",value:function(e,t){return this.helper.ledMapper(e,t)}},{key:"randomLedPixelPosition",value:function(e){var t=this.allLedMetadatas[Math.floor(Math.random()*this.allLedMetadatas.length)];return this.mapTo2d(t,e)}}]),i}(w),oe=function(e){Object(s.a)(i,e);var t=Object(o.a)(i);function i(e){var n;return Object(a.a)(this,i),(n=t.call(this,e)).lastFrameBeatsCount=void 0,n.palette=[],n.lastPaletteSwap=-1,n.signals=void 0,n.swapPalettes(),n.signals=e.signals,n}return Object(r.a)(i,[{key:"renderToCanvas",value:function(e){Date.now()-this.lastPaletteSwap>3e4&&this.signals.soundsLikeStrongBeat&&this.swapPalettes();var t=Math.floor(e.beatController.beatNumber()),i=Math.max(0,t-(this.lastFrameBeatsCount||t));this.lastFrameBeatsCount=t;var n=this.canvas,a=this.canvasContext;a.fillStyle="black",a.globalCompositeOperation="source-over",a.globalAlpha=Object(u.c)(1*e.elapsedSeconds),a.fillRect(0,0,n.width,n.height),a.globalAlpha=1;for(var r=i;r>=1;){var s=this.randomLedPixelPosition(),o=20*Math.random()+20,l=this.randomColor();a.fillStyle=d.m(l),a.globalCompositeOperation="lighter",a.beginPath(),a.arc(s.x,s.y,o,0,2*Math.PI),a.fill(),r-=1}}},{key:"randomColor",value:function(){return this.palette[Math.floor(Math.random()*(this.palette.length-2))+2]}},{key:"swapPalettes",value:function(){this.palette=R(6),this.lastPaletteSwap=Date.now()}}]),i}(se),le=function(e){Object(s.a)(i,e);var t=Object(o.a)(i);function i(e){return Object(a.a)(this,i),t.call(this,new oe(e),.75)}return i}(O),ue=function(e){Object(s.a)(i,e);var t=Object(o.a)(i);function i(e){var n;return Object(a.a)(this,i),(n=t.call(this,e)).info=new Array,n.sparkles=new Array,n.ezTS=void 0,n.reverseLedInfo=void 0,n.signals=void 0,n.palette=[],n.lastPaletteSwap=-1,n.ezTS=e.createEasyTimeSeriesSet(),n.reverseLedInfo=function(e){var t=0;e.forEach((function(e){e.forEach((function(e){t=Math.max(t,e.hardwareChannel)}))}));for(var i=[],n=0;n<t;++n)i.push([]);return e.forEach((function(e,t){e.forEach((function(e,n){i[e.hardwareChannel-1][e.hardwareIndex]={rowIdx:t,idx:n}}))})),i}(n.ledRowMetadatas),n.reverseLedInfo.forEach((function(e){return e})),n.signals=e.signals,n.swapPalettes(),n}return Object(r.a)(i,[{key:"renderRows",value:function(e){var t=this,i=e.elapsedMillis,n=Date.now();if(n-this.lastPaletteSwap>3e4&&this.signals.soundsLikeStrongBeat&&this.swapPalettes(),this.info=this.info.filter((function(e){return n-e.time<1.5*e.speed})),this.ezTS.red.value=this.signals.audioValues.lowRMSZScore20/4,this.ezTS.green.value=this.signals.lowLevel,this.ezTS.orange.value=4*this.signals.audioValues.lowRMSEMA20,this.signals.beatsSinceDrop<16){if(this.signals.soundsLikeNewBeat)for(var a=this.randomColor(),r=0;r<this.reverseLedInfo.length;++r){var s=r%2===1?2e3:1e3;this.info.push({time:n,rib:r,brightness:1,color:a,speed:s})}}else for(var o=Object(u.c)(this.signals.audioValues.unfilteredRMS/.4),l=Object(u.c)(this.signals.audioValues.unfilteredRMS/.2)*(i/1e3*4),c=0;c<l;++c){var h=Math.floor(Math.random()*this.reverseLedInfo.length),v=h%2===1?2e3:1e3;this.info.push({time:n,rib:h,brightness:o,color:this.randomColor(),speed:v})}this.ledRows.forEach((function(e){return e.fill(d.a)}));var f,p=Object(L.a)(this.info);try{for(p.s();!(f=p.n()).done;)for(var m=f.value,b=n-m.time,g=this.reverseLedInfo[m.rib],w=Math.round(b/m.speed*g.length),y=m.brightness,S=w;S>=0&&y>0;--S){var O=d.p(m.color,y);if(y-=.12,S<g.length){var j=g[S],M=j.rowIdx,k=j.idx;this.ledRows.get(M).add(k,O)}}}catch(R){p.e(R)}finally{p.f()}this.sparkles=this.sparkles.filter((function(e){return e.value>0})),this.ledRows.forEach((function(e,i){e.forEach((function(e,n){var a=d.s(e);Math.max(a[0],a[1],a[2])>0&&Math.random()<.002&&t.sparkles.push({value:.8,row:i,idx:n})}))}));var x,C=Object(L.a)(this.sparkles);try{for(C.s();!(x=C.n()).done;){var T=x.value,E=d.o(1,.25*Math.random(),T.value);this.ledRows.get(T.row).add(T.idx,E),T.value+=.15*Math.sin(n/20)-.02}}catch(R){C.e(R)}finally{C.f()}}},{key:"swapPalettes",value:function(){this.palette=R(8),this.lastPaletteSwap=Date.now()}},{key:"randomColor",value:function(){return this.palette[Math.floor(Math.random()*this.palette.length)]}}]),i}(y);var ce=function(e){Object(s.a)(i,e);var t=Object(o.a)(i);function i(e){return Object(a.a)(this,i),t.call(this,new ue(e),.82)}return i}(O),he=function(e){Object(s.a)(i,e);var t=Object(o.a)(i);function i(){var e;Object(a.a)(this,i);for(var n=arguments.length,r=new Array(n),s=0;s<n;s++)r[s]=arguments[s];return(e=t.call.apply(t,[this].concat(r))).phase=0,e}return Object(r.a)(i,[{key:"renderToCanvas",value:function(e){this.phase=(this.phase+180*e.elapsedSeconds)%360;var t=this.phase/180*Math.PI,i=this.canvas,n=this.canvasContext;n.fillStyle="black",n.fillRect(0,0,i.width,i.height);var a=Math.max(i.width,i.height)/2,r=i.width/2,s=i.height/2;n.strokeStyle="white",n.lineCap="round",n.lineWidth=50,n.beginPath(),n.moveTo(r,s),n.lineTo(r+Math.cos(t)*a,s+Math.sin(t)*a),n.stroke()}}]),i}(se),de=function(e){Object(s.a)(i,e);var t=Object(o.a)(i);function i(e){return Object(a.a)(this,i),t.call(this,new he(e),.9)}return i}(O),ve=function(e){Object(s.a)(i,e);var t=Object(o.a)(i);function i(){var e;Object(a.a)(this,i);for(var n=arguments.length,r=new Array(n),s=0;s<n;s++)r[s]=arguments[s];return(e=t.call.apply(t,[this].concat(r))).phase=0,e}return Object(r.a)(i,[{key:"renderToCanvas",value:function(e){var t=90*e.beatController.hz();this.phase=(this.phase+t*e.elapsedSeconds)%360;var i=this.phase/180*Math.PI,n=this.canvas,a=this.canvasContext;a.fillStyle="black",a.globalAlpha=3*e.elapsedSeconds,a.fillRect(0,0,n.width,n.height);var r=n.width/2,s=n.height/2;a.fillStyle=d.m(d.o(this.phase,1,1)),a.globalAlpha=1;var o=r+Math.cos(i)*r,l=s;a.beginPath(),a.arc(o,l,40,0,2*Math.PI),a.fill()}}]),i}(se),fe=function(e){Object(s.a)(i,e);var t=Object(o.a)(i);function i(e){return Object(a.a)(this,i),t.call(this,new ve(e),.9)}return i}(O),pe=function(e){Object(s.a)(i,e);var t=Object(o.a)(i);function i(e,n){var r;Object(a.a)(this,i),r=t.call(this,e);var s=document.createElement("img");return s.onload=function(){r.canvasContext.drawImage(s,0,0,s.width,s.height,0,0,r.canvas.width,r.canvas.height)},s.src=n,r}return Object(r.a)(i,[{key:"renderToCanvas",value:function(e){}}]),i}(se),me=function(e){Object(s.a)(i,e);var t=Object(o.a)(i);function i(e){return Object(a.a)(this,i),t.call(this,e,"./flag.jpg")}return i}(pe);var be=function(e){Object(s.a)(i,e);var t=Object(o.a)(i);function i(e){var n;return Object(a.a)(this,i),(n=t.call(this,e)).paths=void 0,n.phase=0,n.paths=i.generateGaragePaths(e.scene.ledMetadatas),n}return Object(r.a)(i,[{key:"render",value:function(e){var t=this,i=e.elapsedSeconds;this.phase=(this.phase+60*i)%18;var n=Math.round(this.phase);this.paths.forEach((function(e){return e.forEach((function(e,i){var a=(i+n)%18===0?d.i:d.a;t.ledColors.set(e,a)}))}))}}],[{key:"generateGaragePaths",value:function(e){var t=function(e){var t=[];return e.forEach((function(e,i){for(var n=e.hardwareChannel;t.length<=n;)t.push([]);t[n].push(i)})),t}(e),i=[];return Object(u.m)(i,Object(v.a)(t[1]).reverse()),Object(u.m)(i,t[9]),[11,13,15,7,5,3].reverse().forEach((function(e){for(var n=0;n<1;++n)i.push(Object(u.f)(t[e]))})),[i]}}]),i}(w),ge=function(e){Object(s.a)(i,e);var t=Object(o.a)(i);function i(e){var n;Object(a.a)(this,i),(n=t.call(this,e)).ledAddresses=void 0,n.phase=0,n.ledAddresses=[],n.ledRowMetadatas[0].forEach((function(e,t){return n.ledAddresses.push([0,t])}));var r=n.ledRowMetadatas.length-1,s=n.ledRowMetadatas[r].length;return n.ledRowMetadatas[r].forEach((function(e,t){return n.ledAddresses.push([r,s-t-1])})),n}return Object(r.a)(i,[{key:"renderRows",value:function(e){var t=this,i=e.elapsedSeconds;this.phase=(this.phase+10*i)%3;var n=Math.round(this.phase);this.ledAddresses.forEach((function(e,i){var a=Object(Q.a)(e,2),r=a[0],s=a[1],o=(i+n)%3===0?d.i:d.a;t.ledRows.get(r).set(s,o)}))}}]),i}(y),we=function(e){Object(s.a)(i,e);var t=Object(o.a)(i);function i(e){return Object(a.a)(this,i),t.call(this,e,"./owleyes.jpg")}return i}(pe),ye=function(){function e(t){Object(a.a)(this,e),this.deadObjects=void 0,this.objectCreator=void 0,this.deadObjects=[],this.objectCreator=t}return Object(r.a)(e,[{key:"getOrCreate",value:function(){return this.deadObjects.pop()||this.objectCreator()}},{key:"recycle",value:function(e){this.deadObjects.push(e)}}]),e}(),Se=function(){function e(t){Object(a.a)(this,e),this.recycler=void 0,this.liveObjects=void 0,this.deadObjects=void 0,this.recycler=t,this.liveObjects=[],this.deadObjects=[]}return Object(r.a)(e,[{key:"add",value:function(){var e=this.recycler.getOrCreate();return this.liveObjects.push(e),e}},{key:"removeAtIndex",value:function(e){var t=this.liveObjects[e],i=this.liveObjects.pop();t!==i&&(this.liveObjects[e]=i),this.deadObjects.push(t)}},{key:"remove",value:function(e){var t=this.liveObjects.findIndex((function(t){return t===e}));-1!==t&&this.removeAtIndex(t)}},{key:"forEachAndFilter",value:function(e){var t=this,i=[];this.liveObjects.forEach((function(t,n){e(t)||i.push(n)})),Object(u.i)(i,(function(e){return t.removeAtIndex(e)}))}},{key:"size",get:function(){return this.liveObjects.length}}],[{key:"withObjectCreator",value:function(t){return new e(new ye(t))}}]),e}(),Oe=function e(){Object(a.a)(this,e),this.distance=0,this.speed=0,this.radius=0,this.angleRadians=0,this.color=d.a},je=function(e){Object(s.a)(i,e);var t=Object(o.a)(i);function i(e){var n;return Object(a.a)(this,i),(n=t.call(this,e)).numParticlesToAddRemainder=0,n.maxDistance=void 0,n.particles=void 0,n.baseHue=void 0,n.particles=Se.withObjectCreator((function(){return new Oe})),n.maxDistance=Math.max(n.canvas.width,n.canvas.height)/2+30,n.baseHue=Math.floor(360*Math.random()),n}return Object(r.a)(i,[{key:"renderToCanvas",value:function(e){for(var t=this,i=this.numParticlesToAddRemainder+35*e.elapsedSeconds;i>=1;){var n=this.particles.add();n.distance=0,n.speed=250*Math.random()+50,n.radius=20*Math.random()+10,n.angleRadians=Math.random()*Math.PI*2,n.color=d.o(60*Math.pow(Math.random(),2)+this.baseHue,1,.3*Math.random()+.7),i-=1}this.numParticlesToAddRemainder=i;var a=this.canvas,r=this.canvasContext;r.fillStyle=d.m(d.o(this.baseHue,1,.1)),r.globalCompositeOperation="source-over",r.fillRect(0,0,a.width,a.height);var s=a.width/2,o=a.height/2;r.globalCompositeOperation="lighter",this.particles.forEachAndFilter((function(i){if(i.distance+=e.elapsedSeconds*i.speed,i.distance>=t.maxDistance)return!1;var n=s+Math.sin(i.angleRadians)*i.distance,a=o+Math.cos(i.angleRadians)*i.distance;return r.fillStyle=d.m(i.color),r.beginPath(),r.arc(n,a,i.radius,0,2*Math.PI),r.fill(),!0}))}}]),i}(se),Me=function(e){Object(s.a)(i,e);var t=Object(o.a)(i);function i(e){return Object(a.a)(this,i),t.call(this,new je(e),.9)}return i}(O),ke=function(){function e(t){Object(a.a)(this,e),this.fallGraph=void 0,this.fallGraph=t.map((function(e,i){var n=t[i+1],a=function(e){return{rowIndex:i+1,index:e}};return e.map((function(e){if(void 0===n||0===n.length)return[];var t;for(t=0;t<n.length&&n[t].position.x<e.position.x;++t);return 0===t?[a(0)]:t>=n.length?[a(n.length-1)]:[a(t-1),a(t)]}))}))}return Object(r.a)(e,[{key:"drop",value:function(e){var t=(this.fallGraph[e.rowIndex]||[])[e.index]||[];return 0===t.length?null:t[Math.floor(Math.random()*t.length)]}}]),e}(),xe=function(e){Object(s.a)(i,e);var t=Object(o.a)(i);function i(e){var n;return Object(a.a)(this,i),(n=t.call(this,e)).dropHelper=void 0,n.sparkles=void 0,n.numSparklesRemainder=0,n.dropHelper=new ke(n.ledRowMetadatas),n.sparkles=new Set,n}return Object(r.a)(i,[{key:"renderRows",value:function(e){var t=this,i=e.elapsedSeconds,n=[];this.sparkles.forEach((function(e){if(e.millisUntilFall-=1e3*i,e.millisUntilFall<=0){var a=t.dropHelper.drop(e.address);null===a?n.push(e):(e.address=a,e.millisUntilFall=100,e.color=d.p(e.color,1-e.fadeRate))}})),n.forEach((function(e){return t.sparkles.delete(e)}));for(var a=this.numSparklesRemainder+200*i;a>=1;){var r={address:{rowIndex:0,index:Math.floor(Math.random()*this.ledRows.get(0).length)},color:d.o(200+45*Math.random(),Math.pow(Math.random(),.2),.5*Math.random()+.5),millisUntilFall:100,fadeRate:Math.pow(Math.random(),.2)};this.sparkles.add(r),a-=1}this.numSparklesRemainder=a;var s=Math.pow(.5,i/.1);this.ledRows.forEach((function(e){return e.forEach((function(t,i){return e.set(i,d.p(t,s))}))})),this.sparkles.forEach((function(e){t.ledRows.get(e.address.rowIndex).add(e.address.index,e.color)}))}}]),i}(y),Ce=function(e){Object(s.a)(i,e);var t=Object(o.a)(i);function i(e){var n;return Object(a.a)(this,i),(n=t.call(this,e)).offset=0,n.width=88,n.ludicrousSpeedButton=void 0,n.speedDial=void 0,n.speedDial=e.createDialControl({initialValue:.3,minValue:-1,maxValue:1}),n.ludicrousSpeedButton=e.createButtonControl(),n}return Object(r.a)(i,[{key:"renderSingleRow",value:function(e){var t=e.elapsedMillis,i=this.ludicrousSpeedButton.value;this.speedDial.value;this.offset=(this.offset+.15*t)%360;for(var n=360/this.width,a=Math.ceil(this.leds.length/2),r=0;r<a;++r){var s=this.offset+n*r,o=d.o(s,1,1);this.leds.set(r,o),this.leds.set(this.leds.length-1-r,o)}}}]),i}(S),Te=function(e){Object(s.a)(i,e);var t=Object(o.a)(i);function i(e){return Object(a.a)(this,i),t.call(this,new Ce(e),.92)}return i}(O),Ee=function(e){Object(s.a)(i,e);var t=Object(o.a)(i);function i(){var e;Object(a.a)(this,i);for(var n=arguments.length,r=new Array(n),s=0;s<n;s++)r[s]=arguments[s];return(e=t.call.apply(t,[this].concat(r))).numLedsRemainder=0,e}return Object(r.a)(i,[{key:"render",value:function(e){var t=this,i=e.elapsedSeconds,n=Math.pow(.5,i/.2);this.ledColors.forEach((function(e,i){return t.ledColors.set(i,d.p(e,n))}));for(var a=this.numLedsRemainder+300*i;a>=1;){var r=Math.floor(Math.random()*this.ledColors.length);this.ledColors.set(r,d.i),a-=1}this.numLedsRemainder=a}}]),i}(w),Re=function(e){Object(s.a)(i,e);var t=Object(o.a)(i);function i(e){var n;return Object(a.a)(this,i),(n=t.call(this,e)).phase=0,n.positionTimeSeries=void 0,n.positionTimeSeries=e.createTimeSeries(),n}return Object(r.a)(i,[{key:"renderRows",value:function(e){var t=this,i=e.elapsedSeconds,n=e.beatController;n.hz(),this.phase=this.phase+i*Math.PI*n.hz()/2;var a=Math.pow(Math.sin(this.phase),2),r=a*(this.ledRows.length-1);this.ledRows.forEach((function(e,i){for(var n=Math.pow(1-Math.abs(r-i)/t.ledRows.length,7),a=d.o(0,0,n),s=0;s<e.length;++s){var o=(s-(e.length-1)/2)/((e.length-1)/2),l=Math.max(0,Math.abs(o)-.65)/.35,u=d.p(a,Math.pow(1-l,4));e.set(s,u)}})),this.positionTimeSeries.value=1-a}}]),i}(y),De=function(e){Object(s.a)(i,e);var t=Object(o.a)(i);function i(e){return Object(a.a)(this,i),t.call(this,new Re(e),.4)}return i}(O),Ve=function(e){Object(s.a)(i,e);var t=Object(o.a)(i);function i(e){var n;if(Object(a.a)(this,i),(n=t.call(this,e)).phase=0,n.ribChannels=void 0,n.channelValues=void 0,n.numRows=void 0,n.numColumns=void 0,n.ribChannels=[],n.channelValues=new Map,n.ledRowMetadatas.forEach((function(e,t){var i=[];e.forEach((function(e){var t=e.hardwareChannel;i.includes(t)||(i.push(t),n.channelValues.set(t,0))})),n.ribChannels.push(i)})),n.numRows=n.ribChannels.length,0===n.numRows)throw new Error("no rows");return n.numColumns=n.ribChannels[0].length,n.ribChannels.forEach((function(e){var t=e.length;if(n.numColumns!==t)throw new Error("rows don't all have the same number of columns!")})),n}return Object(r.a)(i,[{key:"doZap",value:function(){for(var e=Math.floor(Math.random()*this.numRows),t=Math.floor(Math.random()*this.numRows),i=d.o(360*Math.random(),.6,1),n=0;n<this.numColumns;++n){var a=n<this.numColumns/2?e:t,r=this.ribChannels[a][n];this.channelValues.set(r,d.k(this.channelValues.get(r)||d.a,i))}}},{key:"renderRows",value:function(e){var t=this,i=e.elapsedMillis,n=e.beatController,a=.005*i;this.channelValues.forEach((function(e,i){t.channelValues.set(i,d.p(e,1-a))})),this.phase+=i;for(var r=1/n.hz()*1e3;this.phase>r;)this.doZap(),this.phase-=r;this.ledRowMetadatas.forEach((function(e,i){var n=t.ledRows.get(i);e.forEach((function(e,i){n.set(i,t.channelValues.get(e.hardwareChannel)||d.a)}))}))}}]),i}(y),Ie=function(e){Object(s.a)(i,e);var t=Object(o.a)(i);function i(){var e;Object(a.a)(this,i);for(var n=arguments.length,r=new Array(n),s=0;s<n;s++)r[s]=arguments[s];return(e=t.call.apply(t,[this].concat(r))).phase=0,e}return Object(r.a)(i,[{key:"drawCircle",value:function(e,t){var i=this.canvas,n=this.canvasContext,a=i.width/2,r=i.height/2;n.fillStyle=d.m(t),n.globalAlpha=1,n.beginPath(),n.arc(a,r,e,0,2*Math.PI),n.fill()}},{key:"renderToCanvas",value:function(e){var t=Date.now();this.phase=(this.phase+30*e.elapsedSeconds)%30;var i=this.canvas,n=this.canvasContext;n.fillStyle="black",n.fillRect(0,0,i.width,i.height);for(var a=0,r=this.phase+Math.max(i.width,i.height);r>0;r-=15)this.drawCircle(r,a%2===0?d.o(2*r+t/80,1,1):d.a),++a}}]),i}(se),Ne=function(e){Object(s.a)(i,e);var t=Object(o.a)(i);function i(e){return Object(a.a)(this,i),t.call(this,new Ie(e),.9)}return i}(O),Le=i(14);var ze=function(e){Object(s.a)(i,e);var t=Object(o.a)(i);function i(e,n){var r;if(Object(a.a)(this,i),(r=t.call(this,e)).entries=void 0,r.lastVisualization=void 0,r.currentVisualization=void 0,r.currentVisualizationIndex=0,r.currentBranchedAudioNode=void 0,r.timeAtSwitch=0,r.secondsUntilSwitch=0,r.button=void 0,r.entries=n.visualizations,r.entries.length<1)throw new Error("must have at least 1 visualization");return r.switchToVisualization(0),r}return Object(r.a)(i,[{key:"switchToVisualization",value:function(e){this.currentVisualizationIndex=e;var t=this.entries[e];void 0!==this.currentBranchedAudioNode&&this.currentBranchedAudioNode.disconnect(),null!==this.config.audioSource&&(this.currentBranchedAudioNode=function(e){if(void 0!==e){var t=new GainNode(e.context);return e.connect(t),t}}(this.config.audioSource)),this.config.reset();var i=document.createElement("div"),n=document.createElement("div");n.innerText=t.displayName,n.style.backgroundColor="gray",n.style.color="white",n.style.fontSize="12px",n.style.padding="5px",i.appendChild(n);var a=document.createElement("div");i.appendChild(a),this.config.setExtraDisplay(i),this.button=this.config.createButtonControl({buttonNumber:5});var r=Object(Le.a)(Object(Le.a)({},this.config),{},{setExtraDisplay:function(e){a.innerHTML="",null!==e&&a.appendChild(e)},audioSource:this.currentBranchedAudioNode}),s=new t.visualization(r);this.lastVisualization=this.currentVisualization,this.currentVisualization=s,this.timeAtSwitch=Date.now(),this.secondsUntilSwitch=t.duration}},{key:"goToNextVisualization",value:function(){this.switchToVisualization((this.currentVisualizationIndex+1)%this.entries.length)}},{key:"render",value:function(e){var t=this;this.secondsUntilSwitch-=e.elapsedSeconds,(this.secondsUntilSwitch<0||this.button&&this.button.pressedSinceLastFrame)&&this.goToNextVisualization();var i=Date.now();i-this.timeAtSwitch>5e3&&(this.lastVisualization=void 0);var n=this.currentVisualization;if(void 0!==n&&(n.render(e),n.ledColors.copy(this.ledColors)),void 0!==this.lastVisualization){this.lastVisualization.render(e);var a=(i-this.timeAtSwitch)/5e3;this.lastVisualization.ledColors.forEach((function(e,i){a<801571*i%1e3/1e3&&t.ledColors.set(i,e)}))}}}]),i}(w),Ae=function(e){Object(s.a)(i,e);var t=Object(o.a)(i);function i(e){return Object(a.a)(this,i),t.call(this,e,{visualizations:[{displayName:"Expanding Dashes",visualization:D,duration:420},{displayName:"Sparkles",visualization:Ee,duration:120},{displayName:"Dot",visualization:ve,duration:60},{displayName:"Fourier Twinkle",visualization:N,duration:240},{displayName:"Clock",visualization:he,duration:60},{displayName:"Fire",visualization:je,duration:120},{displayName:"Derez Shooters",visualization:ce,duration:420},{displayName:"Rainbow",visualization:Ce,duration:240},{displayName:"Flap",visualization:De,duration:60},{displayName:"Pulsing Rain",visualization:Y,duration:420},{displayName:"Derez Zoom",visualization:Ne,duration:240},{displayName:"Marquee",visualization:ge,duration:60},{displayName:"Splotches",visualization:oe,duration:300},{displayName:"Derez Clock",visualization:de,duration:60},{displayName:"Expanding Dashes",visualization:D,duration:420},{displayName:"Derez Fire",visualization:Me,duration:180},{displayName:"Marquee",visualization:ge,duration:60},{displayName:"Zoom",visualization:Ie,duration:240},{displayName:"Derez Rainbow",visualization:Te,duration:240},{displayName:"Zaps",visualization:Ve,duration:60},{displayName:"Derez Dot",visualization:fe,duration:180},{displayName:"Clock",visualization:he,duration:60},{displayName:"Shooters",visualization:ue,duration:420},{displayName:"Flap",visualization:De,duration:60},{displayName:"Derez Splotches",visualization:le,duration:300},{displayName:"Marquee",visualization:ge,duration:60},{displayName:"Sparkles",visualization:Ee,duration:120}]})}return i}(ze),Be=function(e){Object(s.a)(i,e);var t=Object(o.a)(i);function i(e){return Object(a.a)(this,i),t.call(this,e,{visualizations:[{displayName:"Rainbow",visualization:Ce,duration:5},{displayName:"Zoom",visualization:Ie,duration:5},{displayName:"Marquee",visualization:ge,duration:5}]})}return i}(ze),Pe=function(e){Object(s.a)(i,e);var t=Object(o.a)(i);function i(e){var n;if(Object(a.a)(this,i),(n=t.call(this,e)).analyser=void 0,n.buffer=void 0,void 0!==e.audioSource){var r=e.audioSource.context,s=new AnalyserNode(r);s.fftSize=64,e.audioSource.connect(s),n.analyser=s,n.buffer=new Uint8Array(n.analyser.frequencyBinCount)}else n.analyser=null,n.buffer=new Uint8Array(0);return n}return Object(r.a)(i,[{key:"renderToCanvas",value:function(e){var t=this.analyser;if(null!==t){var i=this.canvas,n=this.canvasContext;n.fillStyle="black",n.globalCompositeOperation="source-over",n.globalAlpha=1,n.fillRect(0,0,i.width,i.height),n.fillStyle="white";var a=i.width/this.buffer.length/2,r=(i.height-1)/2;t.getByteFrequencyData(this.buffer),this.buffer.forEach((function(e,t){var s=r*(e/255);n.fillRect(.5*i.width+a*t,r-s/2,a+1,s),n.fillRect(.5*i.width-a*t,r-s/2,a+1,s)}))}}}]),i}(se),Fe=function(e){Object(s.a)(i,e);var t=Object(o.a)(i);function i(e){var n;if(Object(a.a)(this,i),(n=t.call(this,e)).analyser=void 0,n.buffer=void 0,void 0!==e.audioSource){var r=e.audioSource.context,s=new AnalyserNode(r);s.fftSize=1024,e.audioSource.connect(s),n.analyser=s,n.buffer=new Float32Array(n.analyser.fftSize)}else n.analyser=null,n.buffer=new Float32Array(0);return n}return Object(r.a)(i,[{key:"renderToCanvas",value:function(e){var t=this.analyser;if(null!==t){var i=this.canvas,n=this.canvasContext;n.fillStyle="black",n.globalCompositeOperation="source-over",n.globalAlpha=1,n.fillRect(0,0,i.width,i.height),n.fillStyle="white";var a=i.width/this.buffer.length,r=(i.height-1)/2;t.getFloatTimeDomainData(this.buffer),this.buffer.forEach((function(e,t){var i=r*Math.abs(e)*3;n.fillRect(a*t,r-i/2,a,i)}))}}}]),i}(se),He=function(e){Object(s.a)(i,e);var t=Object(o.a)(i);function i(e){var n;return Object(a.a)(this,i),(n=t.call(this,e)).duringBeatTimeSeries=void 0,n.progressToNextBeatTimeSeries=void 0,n.timeSinceLastBeatTimeSeries=void 0,n.duringBeatTimeSeries=e.createTimeSeries(),n.timeSinceLastBeatTimeSeries=e.createTimeSeries(),n.progressToNextBeatTimeSeries=e.createTimeSeries(),n}return Object(r.a)(i,[{key:"render",value:function(e){var t=e.beatController,i=t.timeSinceLastBeat()<.1&&t.beatNumber()%4===0;this.ledColors.fill(i?d.i:d.a),this.duringBeatTimeSeries.value=i?1:0,this.progressToNextBeatTimeSeries.value=t.progressToNextBeat(),this.timeSinceLastBeatTimeSeries.value=t.timeSinceLastBeat()}}]),i}(w),Ue=function(e){Object(s.a)(i,e);var t=Object(o.a)(i);function i(e){var n;Object(a.a)(this,i),(n=t.call(this,e)).analyserHelpers=void 0,n.duringBeatTimeSeries=void 0,n.loudnessTimeSeries=void 0,n.currentRMSAmplitudeTimeSeries=void 0;var r=e.audioSource;return n.analyserHelpers=void 0!==r?G(r):null,n.duringBeatTimeSeries=e.createTimeSeries(),n.loudnessTimeSeries=e.createTimeSeries({color:d.h}),n.currentRMSAmplitudeTimeSeries=e.createTimeSeries({color:d.e}),n}return Object(r.a)(i,[{key:"render",value:function(e){if(null!==this.analyserHelpers){this.analyserHelpers.sampleAll();var t=e.beatController.timeSinceLastBeat()<.1,i=Object(u.c)(this.analyserHelpers.direct.currentMaxAmplitude);this.ledColors.fill(t?i*d.i:d.a),this.duringBeatTimeSeries.value=t?1:0,this.loudnessTimeSeries.value=i,this.currentRMSAmplitudeTimeSeries.value=this.analyserHelpers.direct.currentRMSAmplitude}}}]),i}(w),Ge=function(){function e(t){Object(a.a)(this,e),this.analyser=void 0,this.frequencyDataBuffer=void 0;var i=t.context,n=i.createAnalyser();if(n.fftSize=128,n.smoothingTimeConstant=.8,t.connect(n),this.analyser=n,64!==n.frequencyBinCount)throw new Error("incorrect number of frequency bins");this.frequencyDataBuffer=new Uint8Array(64)}return Object(r.a)(e,[{key:"getFrequencyData",value:function(){return null!==this.analyser?this.analyser.getByteFrequencyData(this.frequencyDataBuffer):this.frequencyDataBuffer.fill(0),this.frequencyDataBuffer}}]),e}(),qe=function(e){Object(s.a)(i,e);var t=Object(o.a)(i);function i(e){var n;return Object(a.a)(this,i),(n=t.call(this,e)).fft=void 0,n.pulseValueTimeSeries=void 0,n.fft=void 0===e.audioSource?null:new Ge(e.audioSource),n.pulseValueTimeSeries=e.createTimeSeries(),n}return Object(r.a)(i,[{key:"renderRows",value:function(e){if(null!==this.fft){var t=this.fft.getFrequencyData(),i=0;t.forEach((function(e){return i+=e}));var n=Object(u.b)(0,1,i/t.length/255);this.ledRows.forEach((function(e){e.fill(d.a);for(var t=Math.floor(e.length/2),i=n*e.length,a=Math.max(0,Math.floor(t-i/2)),r=Math.min(e.length-1,Math.floor(t+i/2)),s=a;s<=r;++s)e.set(s,d.i)})),e.setFrameHeatmapValues(Array.from(t.values()).map((function(e){return e/255}))),this.pulseValueTimeSeries.value=n}}}]),i}(y),We=.5,_e=function(){function e(t){Object(a.a)(this,e),this.canvas=void 0,this.data=void 0,this.canvasContext=void 0,this.data=t,this.canvas=document.createElement("canvas");var i=this.canvas.getContext("2d");if(null===i)throw new Error("can't get canvas context");this.canvasContext=i,this.canvas.width=t.length*We,this.canvas.height=127.5,this.canvas.style.backgroundColor="black",i.scale(We,We)}return Object(r.a)(e,[{key:"render",value:function(e){var t=e||this.data;if(t.length!==this.data.length)throw new Error("overrideData has a different length");var i=this.canvas,n=this.canvasContext;n.fillStyle="black",n.fillRect(0,0,i.width/We,i.height/We),n.strokeStyle="white",n.lineWidth=2,n.beginPath(),n.moveTo(-1,127),t.forEach((function(e,t){n.lineTo(t,127*e+127)})),n.stroke()}}]),e}(),Ke=function(e){Object(s.a)(i,e);var t=Object(o.a)(i);function i(e){var n;Object(a.a)(this,i),(n=t.call(this,e)).analyserHelpers=void 0,n.canvasHelper=void 0,n.lowTimeSeries=void 0,n.highTimeSeries=void 0;var r=e.audioSource;return void 0!==r?(n.analyserHelpers=G(r),n.canvasHelper=new _e(n.analyserHelpers.direct.currentSamples),e.setExtraDisplay(n.canvasHelper.canvas)):(n.analyserHelpers=null,n.canvasHelper=null),n.lowTimeSeries=e.createTimeSeries({color:d.b}),n.highTimeSeries=e.createTimeSeries({color:d.h}),n}return Object(r.a)(i,[{key:"render",value:function(e){null!==this.analyserHelpers&&(this.analyserHelpers.sampleAll(),null!==this.canvasHelper&&this.canvasHelper.render(this.analyserHelpers.direct.currentSamples),this.lowTimeSeries.value=this.analyserHelpers.low.currentRMSAmplitude,this.highTimeSeries.value=this.analyserHelpers.high.currentRMSAmplitude)}}]),i}(w),Ze=function(e){Object(s.a)(i,e);var t=Object(o.a)(i);function i(e){var n;return Object(a.a)(this,i),(n=t.call(this,e)).rDial=void 0,n.gDial=void 0,n.bDial=void 0,n.timeSerieses=void 0,n.rDial=e.createDialControl(),n.gDial=e.createDialControl(),n.bDial=e.createDialControl(),n.timeSerieses=e.createEasyTimeSeriesSet(),n}return Object(r.a)(i,[{key:"renderRows",value:function(e){var t=this.rDial.value,i=this.gDial.value,n=this.bDial.value;this.ledRows.forEach((function(e){for(var a=Math.floor(e.length/2),r=t*a,s=i*a,o=n*a,l=0;l<e.length;++l){var u=Math.floor(Math.abs(a-l));e.set(l,d.q(u<=r?1:0,u<=s?1:0,u<=o?1:0))}})),this.timeSerieses.red.value=t,this.timeSerieses.green.value=i,this.timeSerieses.blue.value=n}}]),i}(y),Ye=d.i,Xe=d.p(d.h,.25),Je=d.l(Xe,Ye,64);var Qe=function(e){Object(s.a)(i,e);var t=Object(o.a)(i);function i(e){var n;return Object(a.a)(this,i),(n=t.call(this,e,88)).values=void 0,n.decayRate=.003,n.values=new Array(n.leds.length).fill(0),n}return Object(r.a)(i,[{key:"renderSingleRow",value:function(e){var t=this,i=e.elapsedMillis,n=e.pianoState,a=i*this.decayRate;u.p(this.values,(function(e){return Math.max(0,e-a)})),n.changedKeys.forEach((function(e){n.keys[e]&&(t.values[e]=1)})),this.values.forEach((function(e,i){return t.leds.set(i,function(e){e<0?e=0:e>1&&(e=1);var t=Math.floor(63*e);return Je[t]}(e))}))}}]),i}(S),$e=d.i,et=d.a,tt=function(e){Object(s.a)(i,e);var t=Object(o.a)(i);function i(e){return Object(a.a)(this,i),t.call(this,e,88)}return Object(r.a)(i,[{key:"renderSingleRow",value:function(e){var t=this,i=e.pianoState;i.changedKeys.forEach((function(e){var n=i.keys[e];t.leds.set(e,n?$e:et)}))}}]),i}(S),it=function(){function e(t){Object(a.a)(this,e),this.v=new b,this.halfLife=void 0,this.minThreshold=void 0,this.maxThreshold=void 0,this.halfLife=t.halfLife,this.minThreshold=Object(u.q)(t.minThreshold,0),this.maxThreshold=Object(u.q)(t.maxThreshold,1)}return Object(r.a)(e,[{key:"processValue",value:function(e,t){var i=Object(u.c)((e-this.minThreshold)/(this.maxThreshold-this.minThreshold));this.v.decayExponential(this.halfLife,t/1e3),this.v.bumpTo(i)}},{key:"value",get:function(){return this.v.value}}]),e}(),nt=function(){function e(t){Object(a.a)(this,e),this.audioHelper=void 0,this.lowHelper=void 0,this.highHelper=void 0,this.audioHelper=new W(t),this.lowHelper=new it({halfLife:.125,minThreshold:.225,maxThreshold:.6}),this.highHelper=new it({halfLife:.075,minThreshold:.1,maxThreshold:.75})}return Object(r.a)(e,[{key:"sample",value:function(e){var t=this.audioHelper.getValues();this.lowHelper.processValue(t.lowRMS,e),this.highHelper.processValue(t.highRMS,e)}},{key:"lowLevel",get:function(){return this.lowHelper.value}},{key:"highLevel",get:function(){return this.highHelper.value}}]),e}(),at=function(e){Object(s.a)(i,e);var t=Object(o.a)(i);function i(e){var n;return Object(a.a)(this,i),(n=t.call(this,e)).lowTS=void 0,n.highTS=void 0,n.low2TS=void 0,n.high2TS=void 0,n.helper=void 0,n.signals=void 0,n.lowTS=e.createTimeSeries({color:d.b}),n.highTS=e.createTimeSeries({color:d.h}),n.low2TS=e.createTimeSeries({color:d.e}),n.high2TS=e.createTimeSeries({color:d.g}),n.signals=e.signals,n.helper=e.audioSource?new nt(e.audioSource):void 0,n}return Object(r.a)(i,[{key:"renderRows",value:function(e){void 0!==this.helper&&(this.helper.sample(e.elapsedMillis),this.lowTS.value=this.helper.lowLevel,this.highTS.value=this.helper.highLevel,this.low2TS.value=this.signals.lowLevel,this.high2TS.value=this.signals.highLevel,this.ledRows.get(0).fill(d.o(0,.5,this.highTS.value)),this.ledRows.get(this.ledRows.length-1).fill(d.o(240,.5,this.lowTS.value)))}}]),i}(y),rt=i(26),st=i.n(rt);var ot=st.a.memoize((function(e){var t,i,n=e.ledMetadatas,a=n.map((function(e){return e.position})).map((function(e){return new $.wb(e.x,e.y)})),r=ee(a),s=r.maxX-r.minX,o=r.maxY-r.minY,l=e.voronoiMaxDimension;return s>o?(t=l,i=Math.ceil(l/s*o)):(i=l,t=Math.ceil(l/o*s)),{scene:e,canvasWidth:t,canvasHeight:i,ledDataOffsets:a.map((function(e){var n=Math.round((1-(e.x-r.minX)/s)*(t-1));return 4*(Math.round((1-(e.y-r.minY)/o)*(i-1))*t+n)}))}})),lt=function(e){Object(s.a)(i,e);var t=Object(o.a)(i);function i(e){var n;Object(a.a)(this,i),(n=t.call(this,e)).canvas=void 0,n.canvasContext=void 0,n.ledDataOffsets=void 0;var r=ot(e.scene),s=r.canvasWidth,o=r.canvasHeight,l=r.ledDataOffsets;n.canvas=function(e,t){var i=document.createElement("canvas");return i.style.backgroundColor="black",i.width=e,i.height=t,i}(s,o);var u=n.canvas.getContext("2d");if(!u)throw new Error("can't use canvas");return n.canvasContext=u,e.setExtraDisplay(n.canvas),n.ledDataOffsets=l,n}return Object(r.a)(i,[{key:"render",value:function(e){var t=this;this.renderToCanvas(e);var i=this.canvasContext.getImageData(0,0,this.canvas.width,this.canvas.height).data;this.ledDataOffsets.forEach((function(e,n){return t.ledColors.set(n,d.r(i[e],i[e+1],i[e+2]))}))}}]),i}(w),ut=function(e){Object(s.a)(i,e);var t=Object(o.a)(i);function i(){var e;Object(a.a)(this,i);for(var n=arguments.length,r=new Array(n),s=0;s<n;s++)r[s]=arguments[s];return(e=t.call.apply(t,[this].concat(r))).offsetX=0,e.offsetY=0,e}return Object(r.a)(i,[{key:"renderToCanvas",value:function(e){var t=this.canvas,i=this.canvasContext;i.fillStyle="black",i.globalCompositeOperation="source-over",i.globalAlpha=1,i.fillRect(0,0,t.width,t.height),i.fillStyle="white";for(var n=0,a=this.offsetY-16;a<t.height+8;a+=8){n=1-n;for(var r=this.offsetX-8*(1+n);r<t.width+8;r+=16)i.fillRect(r,a,8,8)}this.offsetX=(this.offsetX+8+1*e.elapsedSeconds)%16,this.offsetY=(this.offsetY+8+-20*e.elapsedSeconds)%16}}]),i}(lt),ct=i.p+"static/media/lines.3b32a424.mp4",ht=function(e){Object(s.a)(i,e);var t=Object(o.a)(i);function i(){var e;Object(a.a)(this,i);for(var n=arguments.length,r=new Array(n),s=0;s<n;s++)r[s]=arguments[s];return(e=t.call.apply(t,[this].concat(r))).video=function(){var t=document.createElement("video");return t.src=ct,t.autoplay=!0,t.loop=!0,t.style.display="none",t.width=10,t.height=10,e.canvas.appendChild(t),t}(),e}return Object(r.a)(i,[{key:"renderToCanvas",value:function(e){var t=this.canvas,i=this.canvasContext,n=this.video;i.drawImage(n,0,0,t.width,t.height)}}]),i}(lt),dt=.15,vt=function(){function e(t){Object(a.a)(this,e),this.canvas=void 0,this.data=void 0,this.canvasContext=void 0,this.data=t,this.canvas=document.createElement("canvas");var i=this.canvas.getContext("2d");if(null===i)throw new Error("can't get canvas context");this.canvasContext=i,this.canvas.width=t.length*dt,this.canvas.height=38.25,this.canvas.style.backgroundColor="black",i.scale(dt,dt)}return Object(r.a)(e,[{key:"render",value:function(e){var t=e||this.data;if(t.length!==this.data.length)throw new Error("overrideData has a different length");var i=this.canvas,n=this.canvasContext;n.fillStyle="black",n.fillRect(0,0,i.width/dt,i.height/dt),n.strokeStyle="white",n.lineWidth=2,n.beginPath(),n.moveTo(-1,127),t.forEach((function(e,t){n.lineTo(t,127*e+127)})),n.stroke()}}]),e}();var ft=[0,210,60,270,120,330,180,30,240,90,300,150].map((function(e){return d.o(e,1,1)})),pt=function(e){Object(s.a)(i,e);var t=Object(o.a)(i);function i(e){var n;Object(a.a)(this,i),(n=t.call(this,e)).canvasHelper=void 0,n.rawFreqTimeSeries=void 0,n.freqTimeSeries=void 0,n.amplitudeTimeSeries=void 0,n.analyser=void 0,n.currentSamples=void 0,n.sampleRate=0,n.maHelper=new u.a(5);var r=e.audioSource;return n.currentSamples=new Float32Array(2048),void 0!==r&&(n.analyser=r.context.createAnalyser(),r.connect(n.analyser),n.sampleRate=r.context.sampleRate),n.canvasHelper=new vt(n.currentSamples),e.setExtraDisplay(n.canvasHelper.canvas),n.freqTimeSeries=e.createTimeSeries({color:d.b}),n.rawFreqTimeSeries=e.createTimeSeries({color:d.j}),n.amplitudeTimeSeries=e.createTimeSeries({color:d.h}),n}return Object(r.a)(i,[{key:"render",value:function(e){var t=d.a;if(void 0!==this.analyser){this.analyser.getFloatTimeDomainData(this.currentSamples);var i=.2*function(e){var t=0,i=0;return e.forEach((function(e){e>0&&(t+=e,i++)})),0===i?0:t/i}(this.currentSamples);if(this.amplitudeTimeSeries.value=Math.sqrt(i),i<.001)this.freqTimeSeries.value=0,this.maHelper.reset();else{var n,a=null!==(n=function(e,t){var i=!0,n=[],a=0,r=0;if(e.forEach((function(e,s){if(i){if(e>=t){var o=Math.pow(e,4);a+=s*o,r+=o,i=!1}}else if(e<0){if(r>0){var l=a/r;n.push(l),a=0,r=0}i=!0}})),!(n.length<2)){for(var s=0,o=n.length-1,l=0;l<o;++l)s+=n[l+1]-n[l];return s/o}}(this.currentSamples,i))&&void 0!==n?n:0,r=0===a?void 0:this.sampleRate/a;if(this.rawFreqTimeSeries.value=Math.min(1,(null!==r&&void 0!==r?r:0)/800),void 0===r)this.maHelper.reset();else{this.maHelper.addValue(r);var s=this.maHelper.movingAverage;this.freqTimeSeries.value=Math.min(1,s/800);var o=Math.round(12*Math.log2(s/440)+69);t=ft[(o+144)%12]}}}this.canvasHelper.render(this.currentSamples),this.ledColors.fill(t)}}]),i}(w),mt=function(e){Object(s.a)(i,e);var t=Object(o.a)(i);function i(e){var n;return Object(a.a)(this,i),(n=t.call(this,e)).signals=void 0,n.updateFuncs=void 0,n.updateFuncs=[],n.signals=e.signals,n.attachBooleanTimeSeries({color:d.h,signalName:"isNewBeat",yValue:0}),n.attachBooleanTimeSeries({color:d.g,signalName:"soundsLikeNewBeat",yValue:.1}),n.attachBooleanTimeSeries({color:d.j,signalName:"soundsLikeStrongBeat",yValue:.2}),n.attachNumberTimeSeries({color:d.h,signalName:"highLevel",scaledMinY:.5,scaledMaxY:1}),n.attachNumberTimeSeries({color:d.b,signalName:"lowLevel",scaledMinY:.5,scaledMaxY:1}),n}return Object(r.a)(i,[{key:"render",value:function(e){this.updateFuncs.forEach((function(e){return e()}))}},{key:"attachTimeSeries",value:function(e){var t=this,i=this.config.createTimeSeries({color:e.color});this.updateFuncs.push((function(){var n=t.signals[e.signalName];i.value=e.mapToNormalizedValue(n)}))}},{key:"attachBooleanTimeSeries",value:function(e){this.attachTimeSeries({color:e.color,signalName:e.signalName,mapToNormalizedValue:function(t){return t?e.yValue:NaN}})}},{key:"attachNumberTimeSeries",value:function(e){var t=Object(u.q)(e.scaledMinY,0),i=Object(u.q)(e.scaledMaxY,1);this.attachTimeSeries({color:e.color,signalName:e.signalName,mapToNormalizedValue:function(e){return e<0||e>1?NaN:t+e*(i-t)}})}}]),i}(w),bt=d.i,gt=function(e){Object(s.a)(i,e);var t=Object(o.a)(i);function i(e){var n;Object(a.a)(this,i),(n=t.call(this,e)).timeCounter=0,n.pulseLocationFloat=0,n.channelHueIncrement=void 0;var r=0;e.scene.ledMetadatas.forEach((function(e){e.hardwareChannel>r&&(r=e.hardwareChannel)}));var s=r+1;return n.channelHueIncrement=360/s,n}return Object(r.a)(i,[{key:"render",value:function(e){var t=e.elapsedMillis;this.pulseLocationFloat=(this.pulseLocationFloat+16*t/1e3)%8;var i=Math.floor(this.pulseLocationFloat);this.timeCounter=(this.timeCounter+t)%1e3;for(var n=2*Math.abs(.5-this.timeCounter/1e3),a=0;a<this.ledColors.length;++a)this.ledColors.set(a,this.colorForPixel(a,n,i))}},{key:"colorForPixel",value:function(e,t,i){var n=this.config.scene.ledMetadatas[e],a=n.hardwareIndex;if(a>=2&&a<n.hardwareChannel+2)return d.p(bt,t);var r,s=n.hardwareChannel*this.channelHueIncrement%360;return r=(a-i)%8===0?1:.5,d.o(s,1,r)}}]),i}(w),wt=function(e){Object(s.a)(i,e);var t=Object(o.a)(i);function i(e){var n;return Object(a.a)(this,i),(n=t.call(this,e)).phase=0,n.aTimeSeries=void 0,n.bTimeSeries=void 0,n.cTimeSeries=void 0,n.aTimeSeries=e.createTimeSeries(),n.bTimeSeries=e.createTimeSeries(),n.cTimeSeries=e.createTimeSeries(),n}return Object(r.a)(i,[{key:"render",value:function(e){var t=e.elapsedMillis;this.phase=(this.phase+t/1e3)%(2*Math.PI),this.aTimeSeries.value=(Math.sin(this.phase)+1)/2,this.bTimeSeries.value=(Math.cos(5*this.phase)+1)/2,this.cTimeSeries.value=10*this.phase%(2*Math.PI)<Math.PI?.5:NaN}}]),i}(w),yt=function(e){Object(s.a)(i,e);var t=Object(o.a)(i);function i(e){var n;return Object(a.a)(this,i),(n=t.call(this,e)).element=void 0,n.totalMillis=0,n.element=document.createElement("div"),n.element.style.fontFamily="monospace",n.element.style.padding="0.25em",n.element.innerText="(new)",e.setExtraDisplay(n.element),n}return Object(r.a)(i,[{key:"render",value:function(e){var t=e.elapsedMillis;this.totalMillis+=t,this.element.innerText="total millis: ".concat(Math.floor(this.totalMillis))}}]),i}(w),St=function(e){Object(s.a)(i,e);var t=Object(o.a)(i);function i(e){var n;Object(a.a)(this,i),(n=t.call(this,e)).ledConfigs=void 0;for(var r=0,s={},o=e.scene.ledMetadatas,l=o.map((function(e){var t,i=e.hardwareChannel-1,n=Math.floor(i%8/2),a=2*Math.floor(i/8)+i%2;return a>r&&(r=a),e.hardwareIndex>(null!==(t=s[e.hardwareChannel])&&void 0!==t?t:-1)&&(s[e.hardwareChannel]=e.hardwareIndex),{rib:n,triangle:a}})),c=[],h=360/(r+1),v=0;v<=r;++v)c.push(h*v);return n.ledConfigs=Object(u.e)(o.length,(function(e){var t=l[e],i=o[e],n=i.hardwareIndex,a=i.hardwareChannel;if(n>=8&&n<=t.rib+8)return d.i;var r=0===n||n===s[a];return d.o(c[t.triangle],1,r?1:.1)})).map((function(e){return{baseColor:e}})),n}return Object(r.a)(i,[{key:"render",value:function(e){for(var t=0;t<this.ledColors.length;++t){var i=this.ledConfigs[t];this.ledColors.set(t,i.baseColor)}}}]),i}(w),Ot=new h;Ot.add("burrow","BeatRain",x),Ot.add("burrow","ExpandingDashes",D),Ot.add("burrow","FourierTwinkle",N),Ot.add("burrow","PulsingRain",Y),Ot.add("burrow","SparklesAndFlashes",J),Ot.add("burrow","Splotches",oe),Ot.add("burrow","SpreadShootersAudio",ue),Ot.add("burrow/midi","CenterSpread",A),Ot.add("burrow/midi","GlowWave",P),Ot.add("patterns","PatternClock",he),Ot.add("patterns","PatternDot",ve),Ot.add("patterns","PatternFlag",me),Ot.add("patterns","PatternMarquee",ge),Ot.add("patterns","PatternMarquee2",be),Ot.add("patterns","PatternOwlEyes",we),Ot.add("patterns","PatternParticleFire",je),Ot.add("patterns","PatternRain2",xe),Ot.add("patterns","PatternRainbow",Ce),Ot.add("patterns","PatternSparkles",Ee),Ot.add("patterns","PatternWingFlap",De),Ot.add("patterns","PatternZaps",Ve),Ot.add("patterns","PatternZoom",Ie),Ot.add("playlists","BurrowPlaylist",Ae),Ot.add("playlists","TestPlaylist",Be),Ot.add("tests","ScopeFFT",Pe),Ot.add("tests","ScopeWaveform",Fe),Ot.add("tests","TestAbletonLink",He),Ot.add("tests","TestAudioAndAbletonLink",Ue),Ot.add("tests","TestAudioPulse",qe),Ot.add("tests","TestAudioWaveform",Ke),Ot.add("tests","TestControllerDial",Ze),Ot.add("tests","TestKey",tt),Ot.add("tests","TestKeyFade",Qe),Ot.add("tests","TestLevels",at),Ot.add("tests","TestMappedCanvas",ut),Ot.add("tests","TestMappedVideo",ht),Ot.add("tests","TestPitch",pt),Ot.add("tests","TestSignals",mt),Ot.add("tests","TestStripAddress",gt),Ot.add("tests","TestTimeseriesData",wt),Ot.add("tests","TestVisualizerExtraDisplay",yt),Ot.add("tests","TestWingTriangles",St);var jt=Ot.build(),Mt=i(7),kt=i(6),xt=(i(48),i(15)),Ct=i.n(xt),Tt=i(20),Et=function(){function e(t){var i=this;Object(a.a)(this,e),this.inputDevicesInternal=[],this.deviceListChangedListeners=[],this.currentDeviceId=null,this.currentAudioContext=null,this.currentAudioSource=null,this.onAudioSourceChanged=void 0,this.isValidId=function(e){return null===e||void 0!==i.inputDevices.find((function(t){return t.id===e}))},this.setDevices=function(){var e=Object(Tt.a)(Ct.a.mark((function e(t){return Ct.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:i.inputDevicesInternal=t.filter((function(e){return"audioinput"===e.kind})).map((function(e){return{id:e.deviceId,name:e.label||e.deviceId}})),i.deviceListChangedListeners.forEach((function(e){return e.call(i)}));case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.onAudioSourceChanged=t,this.doAsyncInit()}return Object(r.a)(e,[{key:"doAsyncInit",value:function(){var e=Object(Tt.a)(Ct.a.mark((function e(){return Ct.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0===navigator.mediaDevices){e.next=5;break}return e.next=3,navigator.mediaDevices.getUserMedia({audio:!0});case 3:return e.next=5,navigator.mediaDevices.enumerateDevices().then(this.setDevices);case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"inputDevices",get:function(){return this.inputDevicesInternal}},{key:"inputDeviceById",value:function(e){if(null===e)return null;var t=this.inputDevicesInternal.findIndex((function(t){return t.id===e}));return-1===t?null:this.inputDevicesInternal[t]}},{key:"defaultDeviceId",get:function(){var e=this.inputDevicesInternal.find((function(e){return"Soundflower (2ch)"===e.name}));return void 0===e?null:e.id}},{key:"setCurrentDeviceId",value:function(e){var t=this;if(e!==this.currentDeviceId&&(this.currentDeviceId=e,this.setCurrentAudioSource(null,null),null!==e)){var i={deviceId:e,autoGainControl:!1,echoCancellation:!1,noiseSuppression:!1,sampleRate:44100};navigator.mediaDevices.getUserMedia({audio:i}).then((function(i){if(e===t.currentDeviceId){var n=new AudioContext,a=n.createMediaStreamSource(i),r=n.createChannelSplitter();a.connect(r);var s=n.createGain();s.channelCount=1,s.gain.value=4,r.connect(s,0,0),t.setCurrentAudioSource(n,s)}}))}}},{key:"setCurrentAudioSource",value:function(e,t){e!==this.currentAudioContext&&(null!==this.currentAudioContext&&this.currentAudioContext.close(),this.currentAudioContext=e),t!==this.currentAudioSource&&(null!==this.currentAudioSource&&this.currentAudioSource.disconnect(),this.currentAudioSource=t,this.onAudioSourceChanged(t))}},{key:"addEventListener",value:function(e,t){this.deviceListChangedListeners.includes(t)||this.deviceListChangedListeners.push(t)}},{key:"removeEventListener",value:function(e,t){Object(u.o)(this.deviceListChangedListeners,t)}}]),e}(),Rt=function(){function e(){Object(a.a)(this,e),null==e.instance&&(e.instance=new Dt)}return Object(r.a)(e,[{key:"hz",value:function(){return e.instance.getHz()}},{key:"beatNumber",value:function(){return e.instance.beatNumber()}},{key:"timeSinceLastBeat",value:function(){return e.instance.timeSinceLastBeat()}},{key:"progressToNextBeat",value:function(){return e.instance.progressToNextBeat()}},{key:"onTap",value:function(){e.instance.requestStatus()}}]),e}();Rt.instance=void 0;var Dt=function(){function e(){var t=this;Object(a.a)(this,e),this.ws=null,this.reconnectTimeout=null,this.hz=120,this.aBeatTime=0,this.lastBeatSync=0,this.tryConnectNow=function(){null!==t.reconnectTimeout&&(clearTimeout(t.reconnectTimeout),t.reconnectTimeout=null),null==t.ws&&(t.ws=new WebSocket("ws://localhost:17001"),t.ws.onopen=t.onWebSocketOpen,t.ws.onclose=t.onWebSocketClose,t.ws.onmessage=t.onLinkMessage)},this.onWebSocketOpen=function(){console.log("ableton link websocket open"),t.protectedSend("enable-start-stop-sync")},this.onWebSocketClose=function(e){console.log("ableton link websocket closed because "+e.code),e.target===t.ws&&(t.ws=null,t.tryConnectSoon())},this.protectedSend=function(e){var i;null!=t.ws&&t.ws.readyState===WebSocket.OPEN&&t.ws.send((i=e,(new TextEncoder).encode(i)))},this.onLinkMessage=function(e){if(e.target===t.ws){var i=e.data,n=new FileReader;n.onload=function(){var e,i=n.result.split("\n"),a=Object(L.a)(i);try{for(a.s();!(e=a.n()).done;){var r=e.value.match(/status { :peers ([0-9]+) :bpm ([0-9.]+) :start ([0-9.]+) :beat ([0-9.]+)/);if(null!=r){t.lastBeatSync=t.beatNumber(),t.hz=parseFloat(r[2])/60;var s=parseFloat(r[4]);s-=Math.floor(s),t.aBeatTime=Vt()-s/t.hz}}}catch(o){a.e(o)}finally{a.f()}},n.readAsText(i)}},this.tryConnectNow(),setInterval((function(){t.protectedSend("status")}),2e3)}return Object(r.a)(e,[{key:"tryConnectSoon",value:function(){null===this.reconnectTimeout&&(this.reconnectTimeout=setTimeout(this.tryConnectNow,3e3))}},{key:"getHz",value:function(){return this.hz}},{key:"timeSinceLastBeat",value:function(){var e=Vt()-this.aBeatTime,t=1/this.hz;return e-Math.floor(e/t)*t}},{key:"progressToNextBeat",value:function(){var e=(Vt()-this.aBeatTime)/(1/this.hz);return e-Math.floor(e)}},{key:"beatNumber",value:function(){var e=Vt()-this.aBeatTime,t=1/this.hz;return Math.floor(e/t)+this.lastBeatSync}},{key:"requestStatus",value:function(){this.protectedSend("status")}}]),e}();function Vt(){return Date.now()/1e3}var It=function(){function e(){Object(a.a)(this,e),this.firstBeatStartTime=performance.now(),this.beatLengthMillis=500,this.prevPressTime=null,this.tapsInSequence=0}return Object(r.a)(e,[{key:"onTap",value:function(){var e=performance.now();null!==this.prevPressTime&&e-this.prevPressTime<1500?(this.tapsInSequence+=1,this.beatLengthMillis=e-this.prevPressTime,this.firstBeatStartTime=e-this.beatLengthMillis*(this.tapsInSequence-1)):(this.tapsInSequence=1,this.firstBeatStartTime=e),this.prevPressTime=e}},{key:"hz",value:function(){return 1e3/this.beatLengthMillis}},{key:"beatNumber",value:function(){var e=performance.now();return Math.floor((e-this.firstBeatStartTime)/this.beatLengthMillis)}},{key:"timeSinceLastBeat",value:function(){return(performance.now()-this.firstBeatStartTime)%this.beatLengthMillis/1e3}},{key:"progressToNextBeat",value:function(){return this.timeSinceLastBeat()/this.beatLengthMillis*1e3}}]),e}(),Nt=i(29),Lt=i.n(Nt),zt=i(9),At=function(e){Object(s.a)(i,e);var t=Object(o.a)(i);function i(){var e;Object(a.a)(this,i);for(var n=arguments.length,r=new Array(n),s=0;s<n;s++)r[s]=arguments[s];return(e=t.call.apply(t,[this].concat(r))).onMouseDown=function(){e.props.beatController&&e.props.beatController.onTap(),e.setState({bpm:60*e.props.beatController.hz()})},e.buttonRef=null,e.setButtonRef=function(t){var i=null===e.buttonRef&&null!==t;e.buttonRef=t,i&&e.animate()},e.labelRef=null,e.setLabelRef=function(t){e.labelRef=t},e.label2Ref=null,e.setLabel2Ref=function(t){e.label2Ref=t},e.isAlive=!0,e.animate=function(){if(e.isAlive&&requestAnimationFrame(e.animate),null!==e.buttonRef){var t=e.props.beatController.progressToNextBeat();e.buttonRef.style.backgroundColor=d.m(d.o(0,1,1-t))}if(null!==e.labelRef){var i=60*e.props.beatController.hz();e.labelRef.innerText="".concat(Math.round(i))}if(null!==e.label2Ref){var n=e.props.beatController.beatNumber()%4+1;e.label2Ref.innerText="".concat(n)}},e}return Object(r.a)(i,[{key:"componentWillUnmont",value:function(){Object(Mt.a)(Object(kt.a)(i.prototype),"componentWillUnmount",this)&&Object(Mt.a)(Object(kt.a)(i.prototype),"componentWillUnmount",this).call(this),this.isAlive=!1}},{key:"render",value:function(){return Object(zt.jsx)("div",{className:Lt.a.root,children:this.renderButton()})}},{key:"renderButton",value:function(){return Object(zt.jsxs)("div",{className:Lt.a.button,onMouseDown:this.onMouseDown,ref:this.setButtonRef,children:[Object(zt.jsx)("div",{ref:this.setLabelRef}),Object(zt.jsx)("div",{ref:this.setLabel2Ref})]})}}]),i}(l.Component),Bt=(i(50),function(e){Object(s.a)(i,e);var t=Object(o.a)(i);function i(){var e;Object(a.a)(this,i);for(var n=arguments.length,r=new Array(n),s=0;s<n;s++)r[s]=arguments[s];return(e=t.call.apply(t,[this].concat(r))).onMouseDown=function(){e.props.setButtonValue(e.props.index,!0),document.addEventListener("mouseup",e.onMouseUp)},e.onMouseUp=function(){e.props.setButtonValue(e.props.index,!1),e.removeListeners()},e.removeListeners=function(){document.removeEventListener("mouseup",e.onMouseUp)},e}return Object(r.a)(i,[{key:"componentWillUnmount",value:function(){Object(Mt.a)(Object(kt.a)(i.prototype),"componentWillUnmount",this)&&Object(Mt.a)(Object(kt.a)(i.prototype),"componentWillUnmount",this).call(this),this.removeListeners()}},{key:"render",value:function(){return Object(zt.jsx)("div",{className:"ControlsView-button ".concat(this.props.value?"pressed":""),onMouseDown:this.onMouseDown,children:this.props.index+1})}}]),i}(l.PureComponent)),Pt=function(e){Object(s.a)(i,e);var t=Object(o.a)(i);function i(){var e;Object(a.a)(this,i);for(var n=arguments.length,r=new Array(n),s=0;s<n;s++)r[s]=arguments[s];return(e=t.call.apply(t,[this].concat(r))).state={isDragging:!1},e.startDragValue=0,e.startDragX=0,e.onMouseDown=function(t){e.startDragValue=e.props.value,e.startDragX=t.pageX,e.setState({isDragging:!0}),document.addEventListener("mousemove",e.onMouseMove),document.addEventListener("mouseup",e.onMouseUp)},e.onMouseUp=function(){e.setState({isDragging:!1}),e.removeListeners()},e.onMouseMove=function(t){e.props.setDialValue(e.props.index,Object(u.c)(e.startDragValue+(t.pageX-e.startDragX)/100))},e.removeListeners=function(){document.removeEventListener("mousemove",e.onMouseMove),document.removeEventListener("mouseup",e.onMouseUp)},e}return Object(r.a)(i,[{key:"componentWillUnmount",value:function(){Object(Mt.a)(Object(kt.a)(i.prototype),"componentWillUnmount",this)&&Object(Mt.a)(Object(kt.a)(i.prototype),"componentWillUnmount",this).call(this),this.removeListeners()}},{key:"render",value:function(){return Object(zt.jsxs)("div",{className:["ControlsView-dial",this.state.isDragging?"dragging":""].join(" "),onMouseDown:this.onMouseDown,children:[Object(zt.jsx)("span",{className:"ControlsView-dialIndicator",style:{transform:"translateX(-50%) rotate(".concat(270*this.props.value-135,"deg)")}}),Object(zt.jsx)("span",{className:"ControlsView-dialLabel",children:this.props.index+1})]})}}]),i}(l.PureComponent),Ft=function(e){Object(s.a)(i,e);var t=Object(o.a)(i);function i(){var e;Object(a.a)(this,i);for(var n=arguments.length,r=new Array(n),s=0;s<n;s++)r[s]=arguments[s];return(e=t.call.apply(t,[this].concat(r))).stateChangeTimeout=null,e.setButtonValue=function(t,i){e.props.controllerState.setButtonState(t,i),e.forceUpdate()},e.setDialValue=function(t,i){e.props.controllerState.dialValues[t]=i,e.forceUpdate()},e}return Object(r.a)(i,[{key:"render",value:function(){return Object(zt.jsx)("div",{className:"ControlsView",children:Object(zt.jsxs)("div",{className:"ControlsView-controls",children:[this.renderButtons(),this.renderDials()]})})}},{key:"renderButtons",value:function(){var e=this;return this.render4by2({values:this.props.controllerState.buttonStates,renderFunc:function(t,i){return Object(zt.jsx)(Bt,{index:i,value:t,setButtonValue:e.setButtonValue},"button".concat(i))},flipped:!0})}},{key:"renderDials",value:function(){var e=this;return this.render4by2({values:this.props.controllerState.dialValues,renderFunc:function(t,i){return Object(zt.jsx)(Pt,{index:i,value:t,setDialValue:e.setDialValue},"dial".concat(i))}})}},{key:"render4by2",value:function(e){if(8!==e.values.length)throw new Error("expected 8 values");return Object(zt.jsx)("div",{className:"ControlsView-controlsCluster ".concat(e.className||""),children:(e.flipped?[1,0]:[0,1]).map((function(t){return Object(zt.jsx)("div",{className:"ControlsView-controlsRow",children:[0,1,2,3].map((function(i){var n=4*t+i;return e.renderFunc(e.values[n],n)}))},"row".concat(t))}))})}},{key:"onStateChange",value:function(){var e=this;null===this.stateChangeTimeout&&(this.stateChangeTimeout=setTimeout((function(){e.stateChangeTimeout=null,e.forceUpdate()}),1e3/60))}}]),i}(l.Component),Ht=function(){function e(){var t=this;Object(a.a)(this,e),this.ws=null,this.reconnectTimeout=null,this.tryConnectNow=function(){null!==t.reconnectTimeout&&(clearTimeout(t.reconnectTimeout),t.reconnectTimeout=null),null===t.ws&&(t.ws=new WebSocket("ws://localhost:7890"),t.ws.onopen=t.onWebSocketOpen,t.ws.onclose=t.onWebSocketClose)},this.onWebSocketOpen=function(){},this.onWebSocketClose=function(e){e.target===t.ws&&(t.ws=null,t.tryConnectSoon())},this.tryConnectNow()}return Object(r.a)(e,[{key:"tryConnectSoon",value:function(){null===this.reconnectTimeout&&(this.reconnectTimeout=setTimeout(this.tryConnectNow,3e3))}},{key:"sendData",value:function(e){null!==this.ws&&this.ws.readyState===WebSocket.OPEN&&this.ws.send(e)}}]),e}(),Ut=i(34);function Gt(){for(var e=[],t=0;t<88;++t){var i=t- -21;e.push([128,i,0])}return e}var qt=88,Wt=function(e){Object(s.a)(i,e);var t=Object(o.a)(i);function i(){return Object(a.a)(this,i),t.apply(this,arguments)}return Object(r.a)(i,[{key:"startFrame",value:function(){this.changedKeys=[]}},{key:"endFrame",value:function(){this.changedKeys.sort()}},{key:"applyEvent",value:function(e){switch(e.type){case"keyPressed":case"keyReleased":this.applyPressOrReleaseEvent("keyPressed"===e.type,e.key,e.velocity)}}},{key:"applyPressOrReleaseEvent",value:function(e,t,i){this.keys[t]!==e&&(this.keys[t]=e,this.keyVelocities[t]=i,this.changedKeys.includes(t)||this.changedKeys.push(t))}}]),i}(function(){function e(){Object(a.a)(this,e),this.keys=void 0,this.keyVelocities=void 0,this.changedKeys=void 0,this.keys=new Array(88).fill(!1),this.keyVelocities=new Array(88).fill(0),this.changedKeys=[]}return Object(r.a)(e,[{key:"reset",value:function(){this.keys.fill(!1),this.keyVelocities.fill(0),this.changedKeys=[]}}]),e}());function _t(e){var t=e.toString(16);return(1===t.length?"0":"")+t}var Kt=function(){function e(t,i){Object(a.a)(this,e),this.data=void 0,this.isNoteworthy=void 0,this.pianoEvent=void 0,this.statusDescription=void 0,this.suppressDisplay=void 0,t instanceof Uint8Array?this.data=Array.from(t):this.data=Object(v.a)(t),this.statusDescription=0===this.data.length?null:function(e){switch(e>>4){case 8:return"NOTE_OFF(".concat(15&e,")");case 9:return"NOTE_ON(".concat(15&e,")");default:return null}}(this.data[0]),this.isNoteworthy=null!==this.statusDescription,this.pianoEvent=function(e){if(e.length<1)return null;switch(e[0]){case 128:case 144:if(e.length<2)return null;var t=e[1]+-21;if(t<0||t>=qt)return null;var i=e.length>=3?e[2]/127:1;return{type:144===e[0]&&i>0?"keyPressed":"keyReleased",key:e[1]+-21,velocity:i};default:return null}}(this.data),this.suppressDisplay=i||!1}return Object(r.a)(e,[{key:"toString",value:function(){var e,t;return null===this.pianoEvent?(e=["raw:"].concat(Object(v.a)(this.data.map(_t))),null!==this.statusDescription&&(e[0]=this.statusDescription)):e=[(t=this.pianoEvent,Object.keys(t).map((function(e){var i=t[e];switch(e){case"type":return"".concat(i);case"velocity":return"v=".concat(u.h(i,2));default:return"".concat(e[0],"=").concat(JSON.stringify(i))}})).join(" "))],e.join(" ")}}]),e}(),Zt=function(){function e(){Object(a.a)(this,e),this.listeners=[]}return Object(r.a)(e,[{key:"addListener",value:function(e){this.listeners.includes(e)||this.listeners.push(e)}},{key:"removeListener",value:function(e){this.listeners=this.listeners.filter((function(t){return t!==e}))}},{key:"fire",value:function(e){var t=this;this.listeners.forEach((function(i){return i.onMidiEvent(e,t)}))}}]),e}(),Yt=function(e){Object(s.a)(i,e);var t=Object(o.a)(i);function i(){var e;Object(a.a)(this,i);for(var n=arguments.length,r=new Array(n),s=0;s<n;s++)r[s]=arguments[s];return(e=t.call.apply(t,[this].concat(r))).pendingEvents=[],e.nextTimeout=null,e.latestTimestamp=0,e.dequeueEvents=function(){for(var t=performance.now();e.pendingEvents.length>0;){var i=e.pendingEvents[0];if(void 0!==i.timestamp&&i.timestamp>t)break;e.pendingEvents.shift(),e.fire(i.event)}e.nextTimeout=null,e.scheduleDequeueIfNeeded()},e}return Object(r.a)(i,[{key:"terminate",value:function(){null!==this.nextTimeout&&(clearTimeout(this.nextTimeout),this.nextTimeout=null)}},{key:"fireLater",value:function(e,t){if(t<this.latestTimestamp)throw new Error("got events out of chronological order");this.pendingEvents.push({timestamp:t,event:e}),this.scheduleDequeueIfNeeded()}},{key:"scheduleDequeueIfNeeded",value:function(){if(null===this.nextTimeout&&this.pendingEvents.length>0){var e=this.pendingEvents[0].timestamp;if(void 0===e)throw new Error("this shouldn't happen");var t=performance.now(),i=Math.max(0,e-t);this.nextTimeout=setTimeout(this.dequeueEvents,i)}}},{key:"reset",value:function(){this.pendingEvents=[],this.nextTimeout&&(clearTimeout(this.nextTimeout),this.nextTimeout=null),this.latestTimestamp=0}}]),i}(Zt),Xt=i(27),Jt=i.n(Xt);function Qt(e){for(var t=[],i=arguments.length,n=new Array(i>1?i-1:0),a=1;a<i;a++)n[a-1]=arguments[a];for(var r=0,s=n;r<s.length;r++){var o=s[r];"string"===typeof o?t.push(e[o]):st.a.forEach(o,(function(i,n){i&&t.push(e[n])}))}return t.join(" ")}function $t(e){switch(e%12){case 1:case 4:case 6:case 9:case 11:return!0;default:return!1}}var ei=100/function(){for(var e=0,t=0;t<88;++t)$t(t)||e++;return e}(),ti="".concat(ei,"%"),ii=.6*ei,ni="".concat(ii,"%"),ai=function(e){Object(s.a)(i,e);var t=Object(o.a)(i);function i(){var e;Object(a.a)(this,i);for(var n=arguments.length,r=new Array(n),s=0;s<n;s++)r[s]=arguments[s];return(e=t.call.apply(t,[this].concat(r))).state={isPressed:!1},e}return Object(r.a)(i,[{key:"render",value:function(){var e=this.props,t=e.isBlack,i=e.offset,n=this.state.isPressed;return Object(zt.jsx)("div",{className:Qt(Jt.a,t?"blackKey":"whiteKey",{pressed:n}),style:{width:t?ni:ti,left:"".concat(t?(i+1)*ei-.5*ii:i*ei,"%")}})}},{key:"setIsPressed",value:function(e){this.setState({isPressed:e})}}]),i}(l.PureComponent),ri=function(e){Object(s.a)(i,e);var t=Object(o.a)(i);function i(){var e;Object(a.a)(this,i);for(var n=arguments.length,r=new Array(n),s=0;s<n;s++)r[s]=arguments[s];return(e=t.call.apply(t,[this].concat(r))).registeredMidiEventEmitter=null,e.keyRefs=Object(u.e)(88,(function(){return l.createRef()})),e}return Object(r.a)(i,[{key:"render",value:function(){this.refreshMidiEventEmitter();for(var e=[],t=[],i=-1,n=0;n<88;++n){var a=$t(n);a||i++,(a?t:e).push(Object(zt.jsx)(ai,{offset:i,isBlack:a,ref:this.keyRefs[n]},n))}return Object(zt.jsx)("div",{className:Jt.a.root,children:Object(zt.jsxs)("div",{className:Jt.a.piano,children:[e,t]})})}},{key:"componentWillUnmount",value:function(){var e;this.unregisterMidiEventEmitter(),null===(e=Object(Mt.a)(Object(kt.a)(i.prototype),"componentWillUnmount",this))||void 0===e||e.call(this)}},{key:"setKeyPressed",value:function(e,t){var i;e<0||e>=88?console.log("got out-of-range note",e):null===(i=this.keyRefs[e].current)||void 0===i||i.setIsPressed(t)}},{key:"reset",value:function(){this.keyRefs.forEach((function(e){var t;return null===(t=e.current)||void 0===t?void 0:t.setIsPressed(!1)}))}},{key:"onMidiEvent",value:function(e){var t=e.pianoEvent;if(null!==t)switch(t.type){case"keyPressed":this.setKeyPressed(t.key,!0);break;case"keyReleased":this.setKeyPressed(t.key,!1)}}},{key:"refreshMidiEventEmitter",value:function(){this.props.midiEventEmitter!==this.registeredMidiEventEmitter&&(this.unregisterMidiEventEmitter(),this.props.midiEventEmitter.addListener(this),this.registeredMidiEventEmitter=this.props.midiEventEmitter)}},{key:"unregisterMidiEventEmitter",value:function(){null!==this.registeredMidiEventEmitter&&(this.registeredMidiEventEmitter.removeListener(this),this.registeredMidiEventEmitter=null)}}]),i}(l.PureComponent);function si(e){return new Array(8).fill(e)}var oi=function(){function e(){Object(a.a)(this,e),this.buttonStates=void 0,this.pressesSinceLastFrame=void 0,this.releasesSinceLastFrame=void 0,this.dialValues=void 0,this.buttonStates=si(!1),this.dialValues=si(0),this.pressesSinceLastFrame=[],this.releasesSinceLastFrame=[],this.dialValues[7]=1,this.reset()}return Object(r.a)(e,[{key:"startFrame",value:function(){Object(u.n)(this.pressesSinceLastFrame),Object(u.n)(this.releasesSinceLastFrame)}},{key:"reset",value:function(){var e=this.dialValues[6],t=this.dialValues[7];this.dialValues.fill(0),this.dialValues[6]=Math.min(.95,e),this.dialValues[7]=Math.max(.05,t)}},{key:"handleEvent",value:function(e){if(3===e.data.length){var t=e.data[0];switch(t){case 138:case 154:var i=154===t,n=e.data[1]-36;this.setButtonState(n,i);break;case 176:var a=e.data[1]-1,r=e.data[2]/127;a>=0&&a<8&&(this.dialValues[a]=r)}}}},{key:"setButtonState",value:function(e,t){e>=0&&e<this.buttonStates.length&&(this.buttonStates[e]=t,(t?this.pressesSinceLastFrame:this.releasesSinceLastFrame).push(e))}}]),e}(),li=(i(55),function(e){Object(s.a)(i,e);var t=Object(o.a)(i);function i(){return Object(a.a)(this,i),t.apply(this,arguments)}return Object(r.a)(i,[{key:"render",value:function(){return Object(zt.jsxs)("div",{className:"RightSidebar",children:[Object(zt.jsxs)("div",{className:"RightSidebar-optionsGroup",children:[this.renderSceneSelector(),Object(zt.jsx)("p",{}),this.renderVisualizationGroupSelector(),this.renderVisualizationSelector(),Object(zt.jsx)("p",{}),this.renderAudioInputDevices(),this.renderPianoMidiInputDevices(),this.renderPianoMidiThruDevices(),this.renderControllerMidiDevices(),this.renderBeatControllerDevices(),Object(zt.jsx)("p",{})]}),Object(zt.jsxs)("div",{className:"RightSidebar-appVersion",children:["v","0.29.0"]})]})}},{key:"renderSceneSelector",value:function(){return this.renderDropDownOption({label:"Scene",currentOption:this.props.selectedSceneName,options:this.props.sceneNames,optionToValueFunc:u.j,onChange:this.props.actions.setSelectedSceneName})}},{key:"renderVisualizationGroupSelector",value:function(){return this.renderDropDownOption({label:"Vis Group",currentOption:this.props.selectedVisualizationGroupName,options:this.props.visualizationGroupNames,optionToValueFunc:u.j,onChange:this.props.actions.setSelectedVisualizationGroupName})}},{key:"renderVisualizationSelector",value:function(){return this.renderDropDownOption({label:"Visualization",currentOption:this.props.selectedVisualizationName,options:this.props.visualizationNames,optionToValueFunc:u.j,onChange:this.props.actions.setSelectedVisualizationName})}},{key:"renderAudioInputDevices",value:function(){var e=this.props.audioInputs;return void 0===e?"(initializing audio in...)":this.renderDropDownOption({label:"Audio in",currentOption:this.props.selectedAudioInput,options:[null].concat(Object(v.a)(e)),optionToValueFunc:function(e){return null===e?"":e.id},optionToLabelFunc:function(e){return null===e?"<none>":e.name},onChange:this.props.actions.setAudioInput})}},{key:"renderPianoMidiInputDevices",value:function(){return this.renderMidiDropDownOption({label:"Piano MIDI in",currentOption:this.props.selectedPianoMidiInput,options:this.props.midiInputs,onChange:this.props.actions.setPianoMidiInput})}},{key:"renderPianoMidiThruDevices",value:function(){return this.renderMidiDropDownOption({label:"Piano MIDI thru",currentOption:this.props.selectedPianoMidiThru,options:this.props.midiOutputs,onChange:this.props.actions.setPianoMidiThru})}},{key:"renderControllerMidiDevices",value:function(){return this.renderMidiDropDownOption({label:"Ctrl MIDI in",currentOption:this.props.selectedControllerMidiInput,options:this.props.midiInputs,onChange:this.props.actions.setControllerMidiInput})}},{key:"renderBeatControllerDevices",value:function(){var e=this.props.selectedBeatControllerType;return this.renderDropDownOption({label:"Beat ctrl",currentOption:e,options:["manual","ableton"],optionToValueFunc:u.j,onChange:this.props.actions.setBeatControllerType})}},{key:"renderMidiDropDownOption",value:function(e){return this.renderDropDownOption({label:e.label,currentOption:e.currentOption,options:[null].concat(Object(v.a)(e.options)),optionToValueFunc:function(e){return null===e?"":e.id},optionToLabelFunc:function(e){return null===e?"<none>":Object(u.q)(e.name,e.id)},onChange:e.onChange})}},{key:"renderDropDownOption",value:function(e){var t=e.currentOption,i=e.options,n=e.optionToLabelFunc,a=e.optionToValueFunc,r=i.map(a),s=n?i.map(n):r,o=a(t);return Object(zt.jsxs)("div",{className:"RightSidebar-dropDownOption",children:[Object(zt.jsxs)("span",{className:"RightSidebar-dropDownOptionLabel",children:[e.label,":"," "]}),Object(zt.jsx)("div",{className:"RightSidebar-dropDownOptionSelectContainer",children:Object(zt.jsx)("select",{className:"RightSidebar-dropDownOptionSelect",value:o,onChange:function(t){var n=r.indexOf(t.target.value);if(-1===n)throw new Error("invalid value");e.onChange(i[n])},tabIndex:-1,children:r.map((function(e,t){return Object(zt.jsx)("option",{value:e,children:s[t]},e)}))})})]})}}]),i}(l.PureComponent)),ui=(i(31),i(16)),ci=i(25),hi=i(35),di=i(39),vi=i(36),fi=i(40);function pi(){var e=new $.ib,t=new $.k(1118481);return t.position.set(-100,100,100),t.castShadow=!1,t.receiveShadow=!1,e.add(t),(t=new $.k(197379)).position.set(100,100,-100),t.castShadow=!1,t.receiveShadow=!1,e.add(t),e}var mi=function(){function e(t,i,n){Object(a.a)(this,e),this.material=void 0,this.removeFromScene=void 0,this.material=e.MATERIAL.clone();var r=new $.K(i,this.material);r.position.copy(n),r.castShadow=!1,r.receiveShadow=!1,t.add(r),this.removeFromScene=function(){t.remove(r)}}return Object(r.a)(e,[{key:"setColor",value:function(e){this.material.color.set(e)}}]),e}();mi.MATERIAL=new $.L({side:$.l});var bi=function(){function e(t,i){Object(a.a)(this,e),this.renderScene=void 0,this.ledGeometry=void 0,this.renderScene=t,this.ledGeometry=new $.X(2*i,2*i)}return Object(r.a)(e,[{key:"createAt",value:function(e){return new mi(this.renderScene,this.ledGeometry,e)}}]),e}(),gi=function(){function e(t,i){Object(a.a)(this,e),this.size=void 0,this.ledMeshes=void 0,this.onSend=void 0,this.averageSendTime=0,this.size=t.length,this.ledMeshes=t,this.onSend=i,this.reset()}return Object(r.a)(e,[{key:"setColor",value:function(e,t){e>=0&&e<this.ledMeshes.length&&this.ledMeshes[e].setColor(t)}},{key:"setRange",value:function(e,t,i){if(e<0&&(t+=e,e=0),(t=Math.min(t,this.size-e))>0)for(var n=e;n<e+t;++n)this.ledMeshes[n].setColor(i)}},{key:"reset",value:function(e){this.setRange(0,this.size,e||d.a)}},{key:"send",value:function(){this.onSend()}}]),e}(),wi=function(){function e(t,i,n){Object(a.a)(this,e),this.scene=void 0,this.ledStrip=void 0,this.ledMeshes=[];var r=new bi(i,t.ledRadius);this.scene=t;var s,o=Object(L.a)(t.ledMetadatas);try{for(o.s();!(s=o.n()).done;){var l=s.value;this.ledMeshes.push(r.createAt(l.position))}}catch(u){o.e(u)}finally{o.f()}this.ledStrip=new gi(this.ledMeshes,n)}return Object(r.a)(e,[{key:"remove",value:function(){this.ledMeshes.forEach((function(e){return e.removeFromScene()}))}}]),e}(),yi=Object(ci.a)("scene"),Si=Object(ci.a)("visualizationRunner"),Oi=Object(ci.a)("container"),ji=Object(ci.a)("active"),Mi=function(){function e(){var t=this;Object(a.a)(this,e),this.renderer=void 0,this.composer=void 0,this.renderPass=void 0,this.bloomPass=void 0,this.camera=void 0,this.controls=void 0,Object.defineProperty(this,yi,{writable:!0,value:void 0}),Object.defineProperty(this,Si,{writable:!0,value:void 0}),Object.defineProperty(this,Oi,{writable:!0,value:null}),Object.defineProperty(this,ji,{writable:!0,value:!0}),this.renderScene=void 0,this.ledScene=void 0,this.frameDidRender=void 0,this.enableBloom=!0,this.doRender=function(){var e,i=performance.now();Object(ui.a)(t,ji)[ji]&&(t.enableBloom?t.composer.render():t.renderer.render(t.renderScene,t.camera));var n=performance.now()-i;null===(e=t.frameDidRender)||void 0===e||e.call(t,n)},this.updateSizes=function(){var e=Object(ui.a)(t,Oi)[Oi];if(null!==e){var i=e.clientWidth,n=e.clientHeight,a=(window.devicePixelRatio||1)/1,r=t.camera,s=t.bloomPass,o=t.composer;r.aspect=i/n,r.updateProjectionMatrix(),t.renderer.setSize(i,n),t.renderer.setPixelRatio(a),o.setSize(i,n),o.setPixelRatio(a),s.setSize(i*a,n*a),t.controls.update()}},this.renderer=new $.Ab({antialias:!0,preserveDrawingBuffer:!1}),this.renderer.outputEncoding=$.Bb,this.camera=new $.W(50,1,.1,1e3),this.controls=new hi.a(this.camera,this.renderer.domElement),this.renderScene=pi(),this.composer=new di.a(this.renderer),this.renderPass=new vi.a(this.renderScene,this.camera),this.bloomPass=new fi.a(new $.wb,1,.1,.1),this.composer.addPass(this.renderPass),this.composer.addPass(this.bloomPass)}return Object(r.a)(e,[{key:"container",set:function(e){var t=Object(ui.a)(this,Oi)[Oi];e!==t&&(null!==t&&t.removeChild(this.renderer.domElement),null!==e?(e.appendChild(this.renderer.domElement),this.controls.domElement=e):this.controls.domElement=this.renderer.domElement,this.controls.update(),Object(ui.a)(this,Oi)[Oi]=e,null!==e&&this.updateSizes())}},{key:"scene",set:function(e){var t=this;if(e!==Object(ui.a)(this,yi)[yi]){Object(ui.a)(this,yi)[yi]=e,void 0!==this.ledScene&&(this.ledScene.remove(),this.ledScene=void 0);var i=pi();this.renderScene=i,void 0!==this.renderPass&&(this.renderPass.scene=this.renderScene),e.loadModel().then((function(e){t.renderScene===i&&t.renderScene.add(e)})),this.ledScene=new wi(e,this.renderScene,this.doRender),this.camera.position.copy(e.cameraStartPosition),this.controls.target=e.cameraTarget,this.controls.update(),Object(ui.a)(this,Si)[Si]&&(Object(ui.a)(this,Si)[Si].simulationLedStrip=this.ledScene.ledStrip)}}},{key:"visualizationRunner",set:function(e){e!==Object(ui.a)(this,Si)[Si]&&(Object(ui.a)(this,Si)[Si]&&(Object(ui.a)(this,Si)[Si].simulationLedStrip=void 0,Object(ui.a)(this,Si)[Si]=void 0),Object(ui.a)(this,Si)[Si]=e,this.ledScene&&(Object(ui.a)(this,Si)[Si].simulationLedStrip=this.ledScene.ledStrip))}},{key:"destroy",value:function(){this.ledScene&&Object(ui.a)(this,Si)[Si]&&Object(ui.a)(this,Si)[Si].simulationLedStrip===this.ledScene.ledStrip&&(Object(ui.a)(this,Si)[Si].simulationLedStrip=void 0),this.ledScene&&(this.ledScene.remove(),this.ledScene=void 0),this.container=null}},{key:"active",set:function(e){Object(ui.a)(this,ji)[ji]=e}}]),e}(),ki=function(e){Object(s.a)(i,e);var t=Object(o.a)(i);function i(){var e;Object(a.a)(this,i);for(var n=arguments.length,r=new Array(n),s=0;s<n;s++)r[s]=arguments[s];return(e=t.call.apply(t,[this].concat(r))).simulationRenderer=new Mi,e.setContainer=function(t){e.simulationRenderer.container=t},e.updateSizes=function(){return e.simulationRenderer.updateSizes()},e.onWindowBlur=function(){return e.simulationRenderer.active=!1},e.onWindowFocus=function(){return e.simulationRenderer.active=!0},e}return Object(r.a)(i,[{key:"componentDidMount",value:function(){var e;null===(e=Object(Mt.a)(Object(kt.a)(i.prototype),"componentDidMount",this))||void 0===e||e.call(this),window.addEventListener("resize",this.updateSizes),window.addEventListener("blur",this.onWindowBlur),window.addEventListener("focus",this.onWindowFocus)}},{key:"componentWillUnmount",value:function(){var e;this.simulationRenderer.destroy(),window.removeEventListener("resize",this.updateSizes),window.removeEventListener("blur",this.onWindowBlur),window.removeEventListener("focus",this.onWindowFocus),null===(e=Object(Mt.a)(Object(kt.a)(i.prototype),"componentWillUnmount",this))||void 0===e||e.call(this)}},{key:"render",value:function(){var e,t=this.props,i=this.simulationRenderer;return i.scene=t.scene,i.visualizationRunner=t.visualizationRunner,i.frameDidRender=t.frameDidRender,i.enableBloom=null!==(e=t.enableBloom)&&void 0!==e&&e,Object(zt.jsx)("div",{className:"SimulationViewport",ref:this.setContainer})}}]),i}(l.Component),xi="simulatorSettings:";function Ci(e){var t=window.localStorage.getItem(xi+e.key),i=null===t?void 0:JSON.parse(t);return void 0===i||void 0!==e.validateFunc&&!e.validateFunc(i)?e.defaultValue:i}function Ti(e,t){window.localStorage.setItem(xi+e,JSON.stringify(t))}i(56);var Ei=function(){function e(){Object(a.a)(this,e)}return Object(r.a)(e,[{key:"drawHeatmapColumn",value:function(e,t){var i=e.canvas,n=i.height/t.values.length,a=t.baseColor;t.values.forEach((function(r,s){e.fillStyle=d.m(d.p(a,r)),e.fillRect(i.width-1,(t.values.length-1-s)*n,1,n)}))}}]),e}(),Ri=function(e){Object(s.a)(i,e);var t=Object(o.a)(i);function i(){var e;Object(a.a)(this,i);for(var n=arguments.length,r=new Array(n),s=0;s<n;s++)r[s]=arguments[s];return(e=t.call.apply(t,[this].concat(r))).canvas=null,e.canvasContext=null,e.heatmapDrawHelper=new Ei,e.setRef=function(t){if(e.canvas=t,null===t)e.canvasContext=null;else{var i=t.getContext("2d");if(null===i)throw new Error("couldn't get canvas context");e.canvasContext=i}},e}return Object(r.a)(i,[{key:"render",value:function(){return Object(zt.jsx)("canvas",{className:"TimeseriesView",ref:this.setRef,height:"".concat(this.props.height,"px"),width:"500px"})}},{key:"displayData",value:function(e,t){var i=this.canvas,n=this.canvasContext;if(null!==i&&null!==n){var a=n.getImageData(1,0,i.width-1,i.height);n.putImageData(a,0,0),void 0!==t&&t.values.length>0?this.heatmapDrawHelper.drawHeatmapColumn(n,t):(n.fillStyle="black",n.fillRect(i.width-1,0,1,i.height));for(var r=e.length-1;r>=0;--r){var s=e[r];isNaN(s.value)||(n.fillStyle=d.m(s.color),n.fillRect(i.width-1,(1-s.value)*(i.height-2),1,2))}}}}]),i}(l.PureComponent),Di=(i(57),function(e){Object(s.a)(i,e);var t=Object(o.a)(i);function i(){var e;Object(a.a)(this,i);for(var n=arguments.length,r=new Array(n),s=0;s<n;s++)r[s]=arguments[s];return(e=t.call.apply(t,[this].concat(r))).state={currentElement:null,currentRef:null},e.setRef=function(t){null!==e.state.currentRef&&null!==e.state.currentElement&&e.state.currentRef.removeChild(e.state.currentElement),null!==t&&null!==e.state.currentElement&&t.appendChild(e.props.element),e.setState({currentRef:t})},e}return Object(r.a)(i,[{key:"render",value:function(){return Object(zt.jsx)("div",{className:"VisualizerExtraDisplayContainer",ref:this.setRef})}}],[{key:"getDerivedStateFromProps",value:function(e,t){var i=t.currentRef;return null!==i&&e.element!==t.currentElement&&(null!==t.currentElement&&i.removeChild(t.currentElement),i.appendChild(e.element)),{currentElement:e.element}}}]),i}(l.PureComponent)),Vi=(i(58),1e3/60),Ii=function(e){Object(s.a)(i,e);var t=Object(o.a)(i);function i(){var e;Object(a.a)(this,i);for(var n=arguments.length,r=new Array(n),s=0;s<n;s++)r[s]=arguments[s];return(e=t.call.apply(t,[this].concat(r))).state={message:""},e.lastUpdateTime=void 0,e.updateInterval=void 0,e.update=function(){var t=e.props.getTimings(),i=performance.now(),n=e.lastUpdateTime?i-e.lastUpdateTime:0,a=t.framesRenderedSinceLastCall/n*1e3,r=t.visualizationMillis/Vi,s=t.fadeCandyMillis/Vi,o=t.renderMillis/Vi,l=r+s+o;e.setState({message:["".concat(Math.round(a)," fps"),"v=".concat(Math.round(100*r),"%"),"f=".concat(Math.round(100*s),"%"),"r=".concat(Math.round(100*o),"%"),"t=".concat(Math.round(100*l),"%")].join(" / ")}),e.lastUpdateTime=i},e}return Object(r.a)(i,[{key:"componentDidMount",value:function(){var e;null===(e=Object(Mt.a)(Object(kt.a)(i.prototype),"componentDidMount",this))||void 0===e||e.call(this),this.updateInterval=setInterval(this.update,1e3),this.update()}},{key:"componentWillUnmount",value:function(){Object(Mt.a)(Object(kt.a)(i.prototype),"componentWillUnmount",this)&&Object(Mt.a)(Object(kt.a)(i.prototype),"componentWillUnmount",this).call(this),this.updateInterval&&(clearInterval(this.updateInterval),this.updateInterval=void 0)}},{key:"render",value:function(){var e=void 0===this.props.message2?"":this.props.message2();return Object(zt.jsxs)("div",{className:"TimingStatsView",children:[this.state.message,""===e?null:Object(zt.jsx)("div",{children:e})]})}}]),i}(l.Component),Ni=function(){function e(){Object(a.a)(this,e),this.elapsedMillis=void 0,this.elapsedSeconds=void 0,this.pianoState=void 0,this.frameHeatmapValues=void 0,this.beatController=void 0;var t="<unset>";this.elapsedMillis=t,this.elapsedSeconds=t,this.beatController=t,this.pianoState=new Wt}return Object(r.a)(e,[{key:"setFrameHeatmapValues",value:function(e){if(void 0!==this.frameHeatmapValues)throw new Error("frame heatmap values set multiple times");this.frameHeatmapValues=e}},{key:"startFrame",value:function(){this.pianoState.startFrame()}},{key:"endFrame",value:function(e,t){this.elapsedMillis=1e3*e,this.elapsedSeconds=e,this.pianoState.endFrame(),this.frameHeatmapValues=void 0,this.beatController=t}},{key:"applyPianoEvent",value:function(e){this.pianoState.applyEvent(e)}}]),e}(),Li=[d.i,d.b,d.h,d.j,d.e,d.f,d.d,d.g,d.c],zi=function(){function e(){var t=this;Object(a.a)(this,e),this.usedColors=[],this.data=[],this.createTimeSeries=function(e){var i;i=void 0===(e=e||{}).color?t.nextDefaultColor():e.color,t.usedColors.push(i);var n=new g(i);return t.data.push(n),n}}return Object(r.a)(e,[{key:"nextDefaultColor",value:function(){var e=this,t=Li.find((function(t){return!e.usedColors.includes(t)}));if(void 0===t)throw new Error("all default colors were used");return t}},{key:"reset",value:function(){this.usedColors=[],this.data=[]}}]),e}(),Ai=function(){function e(t){Object(a.a)(this,e),this.controllerState=void 0,this.index=void 0,this.minValue=void 0,this.maxValue=void 0;var i=t.dialNumber,n=t.controllerState;if(this.controllerState=n,this.index=i-1,this.index<0||this.index>=this.controllerState.dialValues.length)throw new Error("invalid dial number: "+t.dialNumber);this.minValue=t.minValue,this.maxValue=t.maxValue}return Object(r.a)(e,[{key:"value",get:function(){return this.controllerState.dialValues[this.index]*(this.maxValue-this.minValue)+this.minValue},set:function(e){e=Object(u.b)(this.minValue,this.maxValue,e),this.controllerState.dialValues[this.index]=(e-this.minValue)/(this.maxValue-this.minValue)}}]),e}(),Bi=function(){function e(t){Object(a.a)(this,e),this.controllerState=void 0,this.index=void 0;var i=t.buttonNumber,n=t.controllerState;if(this.controllerState=n,this.index=i-1,this.index<0||this.index>=this.controllerState.buttonStates.length)throw new Error("invalid button number: "+t.buttonNumber)}return Object(r.a)(e,[{key:"value",get:function(){return this.controllerState.buttonStates[this.index]}},{key:"pressedSinceLastFrame",get:function(){return this.controllerState.pressesSinceLastFrame.length>0&&console.log(this.controllerState.pressesSinceLastFrame),this.controllerState.pressesSinceLastFrame.includes(this.index)}},{key:"releasedSinceLastFrame",get:function(){return this.controllerState.releasesSinceLastFrame.includes(this.index)}}]),e}(),Pi=[1,2,3,4,5,6,7],Fi=[1,2,3,4,5,6,7,8],Hi=function(){function e(t,i){var n=this;Object(a.a)(this,e),this.controllerState=void 0,this.forceUpdateUI=void 0,this.usedDialNumbers=void 0,this.usedButtonNumbers=void 0,this.createDialControl=function(e){var t;t=void 0===(e=e||{}).dialNumber?n.nextDialNumber():e.dialNumber,n.usedDialNumbers.push(t);var i=Object(u.q)(e.minValue,0),a=Object(u.q)(e.maxValue,1);if(a<=i)throw new Error("dial minValue must be less than maxValue");var r=new Ai({controllerState:n.controllerState,dialNumber:t,minValue:i,maxValue:a});return r.value=Object(u.q)(e.initialValue,i),n.forceUpdateUI(),r},this.createButtonControl=function(e){var t;return t=void 0===(e=e||{}).buttonNumber?n.nextButtonNumber():e.buttonNumber,n.usedButtonNumbers.push(t),new Bi({controllerState:n.controllerState,buttonNumber:t})},this.controllerState=t,this.usedButtonNumbers=[],this.usedDialNumbers=[],this.forceUpdateUI=i}return Object(r.a)(e,[{key:"reset",value:function(){this.usedButtonNumbers=[],this.usedDialNumbers=[]}},{key:"nextDialNumber",value:function(){var e=this,t=Pi.find((function(t){return!e.usedDialNumbers.includes(t)}));if(void 0===t)throw new Error("all dials were used");return t}},{key:"nextButtonNumber",value:function(){var e=this,t=Fi.find((function(t){return!e.usedButtonNumbers.includes(t)}));if(void 0===t)throw new Error("all buttons were used");return t}}]),e}(),Ui=function(){function e(t){var i=this;Object(a.a)(this,e),this.visualization=void 0,this.timingHelper=void 0,this.lastRenderTime=0,this.hardwareLedSender=void 0,this.simulationLedStrip=void 0,this.adjustedLeds=void 0,this.frameContext=void 0,this.timeSeriesHelper=void 0,this.brightnessDial=void 0,this.derezDial=void 0,this.controllerState=void 0,this.signalsHelper=void 0,this.timeSeriesHelper=new zi,this.controllerState=t.controllerState;var n=new Hi(t.controllerState,t.forceUpdateUI);this.brightnessDial=n.createDialControl({dialNumber:8,initialValue:t.controllerState.dialValues[7]}),this.derezDial=n.createDialControl({dialNumber:7,initialValue:t.controllerState.dialValues[6]}),this.signalsHelper=new K(t.audioSource);var r={scene:t.scene,audioSource:t.audioSource,signals:this.signalsHelper,setExtraDisplay:t.setVisualizerExtraDisplay,createTimeSeries:this.timeSeriesHelper.createTimeSeries,createButtonControl:n.createButtonControl,createDialControl:n.createDialControl,createEasyTimeSeriesSet:function(){return{white:i.timeSeriesHelper.createTimeSeries({color:d.i}),blue:i.timeSeriesHelper.createTimeSeries({color:d.b}),red:i.timeSeriesHelper.createTimeSeries({color:d.h}),yellow:i.timeSeriesHelper.createTimeSeries({color:d.j}),green:i.timeSeriesHelper.createTimeSeries({color:d.e}),orange:i.timeSeriesHelper.createTimeSeries({color:d.f})}},reset:function(){i.timeSeriesHelper.reset(),n.reset(),i.controllerState.reset(),t.setVisualizerExtraDisplay(null)}};this.visualization=t.visualizationRegistry.createVisualization(t.visualizationName,r),this.timingHelper=new u.a(20),this.adjustedLeds=this.visualization.ledColors.map((function(e){return d.a})),this.frameContext=new Ni}return Object(r.a)(e,[{key:"renderFrame",value:function(e){var t=performance.now();0===this.lastRenderTime&&(this.lastRenderTime=t-1e3/60);var i=(t-this.lastRenderTime)/1e3;this.frameContext.endFrame(i,e),this.signalsHelper.update(1e3*i,e),this.visualization.render(this.frameContext);var n=this.frameContext.frameHeatmapValues||[];this.controllerState.startFrame(),this.frameContext.startFrame(),this.lastRenderTime=t;var a=performance.now()-t;return this.timingHelper.addValue(a),this.sendToStrips(this.brightnessDial.value,this.derezDial.value),{frameHeatmapValues:n,frameTimeseriesPoints:this.timeSeriesHelper.data}}},{key:"onPianoEvent",value:function(e){this.frameContext.applyPianoEvent(e)}},{key:"averageRenderTime",get:function(){return this.timingHelper.movingAverage}},{key:"sendToStrips",value:function(e,t){var i=this;if(this.visualization.ledColors.forEach((function(n,a){Math.random()>t&&i.adjustedLeds.set(a,d.p(n,e))})),void 0!==this.simulationLedStrip){var n=this.simulationLedStrip;this.adjustedLeds.forEach((function(e,t){return n.setColor(t,e)})),n.send()}void 0!==this.hardwareLedSender&&this.hardwareLedSender.send(this.adjustedLeds)}}]),e}(),Gi=1e3/60;function qi(e,t){return null===t?null:e.find((function(e){return e.id===t}))}function Wi(e){return function(t){return"string"===typeof t&&void 0!==qi(e,t)}}function _i(e,t){var i=Ci({key:t,defaultValue:0===e.length?null:e[0].id,validateFunc:Wi(e)});return"string"!==typeof i?null:function(e,t){var i=qi(e,t);if(void 0===i)throw new Error("can't find by id: ".concat(t));return i}(e,i)}var Ki=function(e){Object(s.a)(i,e);var t=Object(o.a)(i);function i(){var e;Object(a.a)(this,i);for(var n=arguments.length,r=new Array(n),s=0;s<n;s++)r[s]=arguments[s];return(e=t.call.apply(t,[this].concat(r))).midiEventEmitter=new Yt,e.midiControllerEventEmitter=new Zt,e.fadecandyClient=new Ht,e.audioIn=new Et((function(t){e.configureVisualization(e.state.visualizationName,e.state.scene,t)})),e.controllerState=new oi,e._isMounted=!1,e.handleClickSimulationToggleSwitch=function(){var t=!e.state.simulationEnabled;Ti("simulationEnabled",t),e.setState({simulationEnabled:t})},e.getMessage2=function(){return e.state.scene.displayMessage},e.setMidiInput=function(t){t!==e.state.midiInput&&(e.state.midiInput&&(e.state.midiInput.removeEventListener("midimessage",e.onMidiInputMessage),e.resetAllKeys()),t&&t.addEventListener("midimessage",e.onMidiInputMessage),e.setState({midiInput:t}),Ti("midiInputId",null===t?null:t.id))},e.setMidiControllerInput=function(t){t!==e.state.midiControllerInput&&(e.state.midiControllerInput&&(e.state.midiControllerInput.removeEventListener("midimessage",e.onMidiControllerInputMessage),e.resetAllKeys()),t&&t.addEventListener("midimessage",e.onMidiControllerInputMessage),e.setState({midiControllerInput:t}),Ti("midiControllerInputId",null===t?null:t.id))},e.setMidiOutput=function(t){t!==e.state.midiOutput&&(e.setState({midiOutput:t}),Ti("midiOutputId",null===t?null:t.id))},e.updateMidiDevices=function(){var t=e.state,i=t.midiInput,n=t.midiOutput,a=t.midiState,r=t.midiControllerInput;if("loaded"===a.status){var s=a.webMidi;null!==i&&e.setMidiInput(s.inputs.get(i.id)||null),null!==r&&e.setMidiControllerInput(s.inputs.get(r.id)||null),null!==n&&e.setMidiOutput(s.outputs.get(n.id)||null),e.setState({midiInputs:Array.from(s.inputs.values()),midiOutputs:Array.from(s.outputs.values())})}},e.createBeatControllerType=function(e){switch(e){case"manual":return new It;case"ableton":return new Rt;default:throw new Error("unsupported beat controller type: ".concat(e))}},e.setSelectedVisualizationName=function(t){e.state.visualizationName!==t&&(e.configureVisualization(t,e.state.scene,e.state.audioSource),Ti("visualizationName",t))},e.actionManager={setPianoMidiInput:e.setMidiInput,setControllerMidiInput:e.setMidiControllerInput,setPianoMidiThru:e.setMidiOutput,setSelectedSceneName:function(t){if(t!==e.state.scene.name){var i=Object(u.r)(e.props.scenes.get(t));e.configureVisualization(e.state.visualizationName,i,e.state.audioSource),Ti("sceneName",t)}},setSelectedVisualizationGroupName:function(t){if(e.state.visualizationGroupName!==t){e.setState({visualizationGroupName:t});var i=Object(u.f)(e.props.visualizations.visualizationNamesInGroup(t));e.setSelectedVisualizationName(i),Ti("visualizationGroupName",t)}},setSelectedVisualizationName:e.setSelectedVisualizationName,setAudioInput:function(t){e.setState({selectedAudioInput:t});var i=null===t?null:t.id;e.audioIn.setCurrentDeviceId(i),Ti("audioInSourceId",i)},setBeatControllerType:function(t){e.setState({beatController:e.createBeatControllerType(t)}),Ti("beatControllerType",t)}},e.onMidiInputMessage=function(t){var i=new Kt(t.data);e.midiEventEmitter.fire(i),null!==e.state.midiOutput&&null!==e.state.midiInput&&e.state.midiOutput.name!==e.state.midiInput.name&&e.state.midiOutput.send(t.data)},e.onMidiControllerInputMessage=function(t){var i=new Kt(t.data);e.midiControllerEventEmitter.fire(i),e.controllerState.handleEvent(i),e.updateControlsView()},e.resetAllKeys=function(){e.midiEventEmitter.reset(),Gt().forEach((function(t){e.midiEventEmitter.fire(new Kt(t,!0))}))},e.myMidiListener={onMidiEvent:function(t){var i=t.pianoEvent;null!==i&&e.state.visualizationRunner.onPianoEvent(i)}},e.animating=!1,e.prevAnimationStartTimeTarget=0,e.nextAnimationTimeout=void 0,e.scheduleNextAnimationFrame=function(){void 0!==e.nextAnimationTimeout&&(clearTimeout(e.nextAnimationTimeout),e.nextAnimationTimeout=void 0);var t=performance.now(),i=Math.max(t,e.prevAnimationStartTimeTarget+Gi);e.nextAnimationTimeout=setTimeout(e.animate,i-t),e.prevAnimationStartTimeTarget=i},e.animate=function(){if(e.animating){e.scheduleNextAnimationFrame();var t=e.state.visualizationRunner.renderFrame(e.state.beatController),i=t.frameHeatmapValues,n=t.frameTimeseriesPoints;++e.framesRenderedSinceLastTimingsCall,e.timeseriesViewRef&&e.timeseriesViewRef.displayData(n,{baseColor:d.h,values:i})}},e.getTimings=function(){var t=e.state.visualizationRunner.hardwareLedSender,i={visualizationMillis:e.state.visualizationRunner.averageRenderTime,fadeCandyMillis:void 0===t?0:t.averageSendTime,renderMillis:e.state.simulationEnabled?e.renderTimingHelper.movingAverage:0,framesRenderedSinceLastCall:e.framesRenderedSinceLastTimingsCall};return e.framesRenderedSinceLastTimingsCall=0,i},e.renderTimingHelper=new u.a(20),e.framesRenderedSinceLastTimingsCall=0,e.simulationFrameDidRender=function(t){e.renderTimingHelper.addValue(t)},e.updateAudioInDevices=function(){var t=void 0===e.state.audioInputs;e.setState({audioInputs:e.audioIn.inputDevices}),t&&e.actionManager.setAudioInput(e.initialAudioInDevice())},e.timeseriesViewRef=void 0,e.setTimeseriesViewRef=function(t){return e.timeseriesViewRef=t},e.controlsViewRef=null,e.setControlsViewRef=function(t){return e.controlsViewRef=t},e.updateControlsView=function(){null!==e.controlsViewRef&&e.controlsViewRef.onStateChange()},e.state=function(){var t=e.initialScene(),i=e.initialVisualizationGroupName();return Object(Le.a)(Object(Le.a)({visualizationGroupName:i},e.configureVisualization(e.initialVisualizationName(),t,null,!0)),{},{midiState:{status:"initializing"},midiInput:null,midiControllerInput:null,midiOutput:null,midiInputs:[],midiOutputs:[],audioInputs:void 0,selectedAudioInput:null,audioSource:null,simulationEnabled:e.initialSimulationEnabled(),beatController:e.initialBeatController()})}(),e}return Object(r.a)(i,[{key:"componentDidMount",value:function(){var e,t=this;null===(e=Object(Mt.a)(Object(kt.a)(i.prototype),"componentDidMount",this))||void 0===e||e.call(this),Object(Mt.a)(Object(kt.a)(i.prototype),"componentWillMount",this)&&Object(Mt.a)(Object(kt.a)(i.prototype),"componentWillMount",this).call(this),this.audioIn.addEventListener("deviceListChanged",this.updateAudioInDevices),navigator.requestMIDIAccess?navigator.requestMIDIAccess().then((function(e){t.setState({midiState:{status:"loaded",webMidi:e}});var i=Array.from(e.inputs.values()),n=_i(i,"midiInputId");t.setMidiInput(n);var a=_i(i,"midiControllerInputId");t.setMidiControllerInput(a);var r=_i(Array.from(e.outputs.values()),"midiOutputId");t.setMidiOutput(r),t.updateMidiDevices(),e.addEventListener("statechange",t.updateMidiDevices)})).catch((function(e){console.log("exception requesting MIDI access",e),t.setState({midiState:{status:"failed",midiFailureReason:e}})})):this.setState({midiState:{status:"failed",midiFailureReason:"MIDI access not supported on this browser"}}),this.midiEventEmitter.addListener(this.myMidiListener),this.startAnimation(),this._isMounted=!0}},{key:"componentWillUnmount",value:function(){var e;this._isMounted=!1,this.stopAnimation();var t=this.state.midiState;"loaded"===t.status&&t.webMidi.removeEventListener("statechange",this.updateMidiDevices),this.midiEventEmitter.removeListener(this.myMidiListener),this.audioIn.removeEventListener("deviceListChanged",this.updateAudioInDevices),null===(e=Object(Mt.a)(Object(kt.a)(i.prototype),"componentWillUnmount",this))||void 0===e||e.call(this)}},{key:"render",value:function(){return Object(zt.jsxs)("div",{className:"LedStudioRoot",children:[Object(zt.jsxs)("div",{className:"LedStudioRoot-viewportGroup",children:[Object(zt.jsxs)("div",{className:"LedStudioRoot-viewportContainer",children:[this.state.simulationEnabled?Object(zt.jsx)(ki,{scene:this.state.scene,visualizationRunner:this.state.visualizationRunner,frameDidRender:this.simulationFrameDidRender,enableBloom:!0}):null,null===this.state.visualizerExtraDisplay?null:Object(zt.jsx)(Di,{element:this.state.visualizerExtraDisplay}),this.renderSimulationToggleSwitch(),Object(zt.jsx)(Ii,{getTimings:this.getTimings,message2:this.getMessage2})]}),Object(zt.jsx)("div",{className:"LedStudioRoot-audioInViewContainer",children:Object(zt.jsx)(Ri,{ref:this.setTimeseriesViewRef,height:64})}),Object(zt.jsxs)("div",{className:"LedStudioRoot-controllerStateContainer",children:[Object(zt.jsx)(ri,{midiEventEmitter:this.midiEventEmitter}),Object(zt.jsx)(Ft,{controllerState:this.controllerState,ref:this.setControlsViewRef}),Object(zt.jsx)(At,{beatController:this.state.beatController})]})]}),Object(zt.jsx)("div",{className:"LedStudioRoot-sidebarContainer",children:this.renderSidebarContents()})]})}},{key:"renderSimulationToggleSwitch",value:function(){return Object(zt.jsx)("div",{className:"LedStudioRoot-simulationToggleSwitch"+(this.state.simulationEnabled?" enabled":""),onClick:this.handleClickSimulationToggleSwitch,children:this.state.simulationEnabled?"Disable simulation":"Simulation is disabled \u2014 click here to enable"})}},{key:"renderSidebarContents",value:function(){switch(this.state.midiState.status){case"initializing":return"Initializing...";case"loaded":var e=this.state.beatController instanceof It?"manual":"ableton",t=this.state.visualizationGroupName;return Object(zt.jsx)(li,{actions:this.actionManager,sceneNames:this.props.sceneNames,selectedSceneName:this.state.scene.name,visualizationGroupNames:this.props.visualizations.groupNames,selectedVisualizationGroupName:t,visualizationNames:this.props.visualizations.visualizationNamesInGroup(t),selectedVisualizationName:this.state.visualizationName,midiInputs:this.state.midiInputs,selectedPianoMidiInput:this.state.midiInput,selectedControllerMidiInput:this.state.midiControllerInput,midiOutputs:this.state.midiOutputs,selectedPianoMidiThru:this.state.midiOutput,midiEventEmitters:[this.midiEventEmitter,this.midiControllerEventEmitter],audioInputs:this.state.audioInputs,selectedAudioInput:this.state.selectedAudioInput,selectedBeatControllerType:e});case"failed":return"error: ".concat(this.state.midiState.midiFailureReason)}}},{key:"configureVisualization",value:function(e,t,i,n){var a=this,r=!0,s=null;this.controllerState.reset();var o=new Ui({visualizationRegistry:this.props.visualizations,visualizationName:e,scene:t,audioSource:i||(new AudioContext).createGain(),setVisualizerExtraDisplay:function(e){r?s=e:a.setState({visualizerExtraDisplay:e})},controllerState:this.controllerState,forceUpdateUI:function(){a._isMounted&&a.forceUpdate()}});o.hardwareLedSender=new Ut.a(this.fadecandyClient,t.ledMetadatas);var l={visualizationRunner:o,visualizationName:e,scene:t,audioSource:i,visualizerExtraDisplay:s};return r=!1,n||this.setState(l),l}},{key:"startAnimation",value:function(){this.animating||(this.animating=!0,this.scheduleNextAnimationFrame())}},{key:"stopAnimation",value:function(){this.animating=!1}},{key:"initialVisualizationGroupName",value:function(){var e=this;return Ci({key:"visualizationGroupName",defaultValue:Object(u.f)(this.props.visualizations.groupNames),validateFunc:function(t){return e.props.visualizations.groupNames.includes(t)}})}},{key:"initialVisualizationName",value:function(){var e=this,t=this.initialVisualizationGroupName();return Ci({key:"visualizationName",defaultValue:Object(u.f)(this.props.visualizations.visualizationNamesInGroup(t)),validateFunc:function(i){return e.props.visualizations.visualizationNamesInGroup(t).includes(i)}})}},{key:"initialScene",value:function(){var e=this,t=Ci({key:"sceneName",defaultValue:Object(u.g)(this.props.scenes),validateFunc:function(t){return e.props.scenes.has(t)}});return Object(u.r)(this.props.scenes.get(t))}},{key:"initialAudioInDevice",value:function(){var e=Ci({key:"audioInSourceId",defaultValue:this.audioIn.defaultDeviceId,validateFunc:this.audioIn.isValidId});return this.audioIn.inputDeviceById(e)}},{key:"initialSimulationEnabled",value:function(){return"?disableSimulation"!==window.location.search&&Ci({key:"simulationEnabled",defaultValue:!0})}},{key:"initialBeatController",value:function(){var e=Ci({key:"beatControllerType",defaultValue:"manual"});return this.createBeatControllerType(e)}}]),i}(l.Component),Zi=function(e){Object(s.a)(i,e);var t=Object(o.a)(i);function i(){var e;Object(a.a)(this,i);for(var n=arguments.length,r=new Array(n),s=0;s<n;s++)r[s]=arguments[s];return(e=t.call.apply(t,[this].concat(r))).counter=0,e}return Object(r.a)(i,[{key:"render",value:function(){var e="instance".concat(this.counter++);if(this.counter>1)throw new Error("LedStudioRoot has rendered ".concat(this.counter," times"));return l.createElement(Ki,Object(Le.a)(Object(Le.a)({},this.props),{},{sceneNames:Array.from(this.props.scenes.keys()),key:e}))}}]),i}(l.PureComponent),Yi=.01*2.54,Xi=.3048;function Ji(e){var t=e.rightDirection.clone().normalize(),i=e.upDirection.clone().normalize(),n=180*t.angleTo(i)/Math.PI;if(Math.abs(90-Math.abs(n))>.1)throw new Error("right and up don't make sense with relative angle of: "+n);return e.points.map((function(n){var a=e.bottomLeft.clone();return a.addScaledVector(t,n.x),a.addScaledVector(i,n.y),a}))}function Qi(e){return function(){var t=new $.e(e.width,e.height,e.depth);t.translate(0,e.height/2,0),e.translateBy&&t.translate(e.translateBy.x,e.translateBy.y,e.translateBy.z);var i=e.material||new $.M({color:1118481});return new $.K(t,i)}}var $i=function(){return new $.L({color:256,transparent:!0,side:$.l})};function en(e){var t=6*Xi,i=30*Yi,n=.69215,a=new $.U;a.add(Qi({width:t,height:.050800000000000005,depth:i,translateBy:new $.xb(0,n,0)})());var r=e.riserHeight,s=Qi({width:1*Yi,height:n,depth:1*Yi})();return[[-1,-1],[-1,1],[1,1],[1,-1]].forEach((function(e){var t=Object(Q.a)(e,2),i=t[0],n=t[1],o=s.clone(),l=.7620000000000001*i,u=.22860000000000005*n;if(o.position.copy(new $.xb(l,0,u)),a.add(o),r){var c=Qi({width:.1524,depth:.1524,height:r,translateBy:new $.xb(l,-1*r,u)})();a.add(c)}})),e.rotateY&&a.rotateY(e.rotateY),r&&a.children.forEach((function(e){return e.translateY(r)})),a.position.add(e.translateBy),a}function tn(e){var t=e.keyboardInFront?1.5:-1,i=t+(e.keyboardInFront?-1.5:1.35),n=57*Yi;return{model:e.hideKeyboard?void 0:{url:"./keyboard.gltf",scale:new $.xb(.1,.1,.12),translateBy:new $.xb(0,0,i)},extraObjects:[function(){return function(e){var t=new $.U;return t.add(en({translateBy:new $.xb(-.92964,0,0)})),t.add(en({translateBy:new $.xb(.92964,0,0)})),t.add(en({riserHeight:.1524,translateBy:new $.xb(-.92964,0,.7)})),t.add(en({riserHeight:.1524,translateBy:new $.xb(.92964,0,.7)})),t.add(en({rotateY:Math.PI/2,riserHeight:.1524,translateBy:new $.xb(2.27076,0,1.25)})),t.add(en({rotateY:Math.PI/2,riserHeight:.0762,translateBy:new $.xb(-2.27076,0,1.25)})),t.position.add(e.translateBy),t}({translateBy:new $.xb(0,0,t)})},Qi({width:.508,height:n,depth:.254,translateBy:new $.xb(0,0,i+.5),material:$i()}),Qi({width:.254,height:.3048,depth:.254,translateBy:new $.xb(0,1.4732000000000003,i+.5),material:$i()})]}}var nn=i(37),an=i(38),rn=new $.M({color:592137}),sn=function(){function e(t){Object(a.a)(this,e),this.def=void 0,this.lazyModelPromise=void 0,this.displayValues=void 0,this.cachedDisplayMessage=void 0,this.ledRadius=void 0,this.ledMetadatas=void 0,this.def=t,this.ledMetadatas=this.def.leds,this.setDisplayValue("#leds",this.def.leds.length),this.ledRadius=t.ledRadius}return Object(r.a)(e,[{key:"name",get:function(){return this.def.name}},{key:"toString",value:function(){return"<scene:".concat(this.name,">")}},{key:"loadModel",value:function(){var e=Object(Tt.a)(Ct.a.mark((function e(){var t=this;return Ct.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return void 0===this.lazyModelPromise&&(this.lazyModelPromise=Object(nn.promisify)((function(e){var i=t.def.model;void 0!==i?(new an.a).load(i.url,(function(t){var n=t.scene;void 0!==i.scale&&(n=n.clone()).scale.copy(i.scale);var a=(new $.d).setFromObject(n),r=a.getCenter(new $.xb),s=a.min.y;n.translateX(-r.x),n.translateY(-s),n.translateZ(-r.z),i.translateBy&&n.position.add(i.translateBy),e(null,n)}),void 0,(function(t){e(new Error("gltf error: ".concat(t)),null)})):e(null,new $.U)}))().then((function(e){return t.addExtraObjects(e)}))),e.abrupt("return",this.lazyModelPromise);case 2:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"addExtraObjects",value:function(e){var t=new $.ib;if(t.add(e),0!==this.def.floorSizeOverride){var i=this.def.floorSizeOverride||10,n=new $.Y(i,i).rotateX(-1*Math.PI/2),a=new $.K(n,rn);a.translateY(-.001),t.add(a)}return(this.def.extraObjects||[]).forEach((function(e){return t.add(e())})),t}},{key:"cameraTarget",get:function(){return void 0!==this.def.camera&&void 0!==this.def.camera.target?this.def.camera.target:new $.xb(0,0,0)}},{key:"cameraStartPosition",get:function(){return void 0!==this.def.camera&&void 0!==this.def.camera.startPosition?this.def.camera.startPosition.clone():new $.xb(0,0,-10)}},{key:"initDisplayValuesIfNeeded",value:function(){return void 0===this.displayValues&&(this.def.initialDisplayValues?this.displayValues=this.def.initialDisplayValues:this.displayValues={}),this.displayValues}},{key:"setDisplayValue",value:function(e,t){this.initDisplayValuesIfNeeded()[e]=t}},{key:"displayMessage",get:function(){return void 0===this.cachedDisplayMessage&&(this.cachedDisplayMessage=Object.entries(this.initDisplayValuesIfNeeded()).map((function(e){return"".concat(e[0],"=").concat(e[1])})).join(" / ")),this.cachedDisplayMessage}},{key:"voronoiMaxDimension",get:function(){return this.def.voronoiMaxDimension}}]),e}(),on=1/30,ln=[23,20,22,26],un=[46,44,44,53],cn=.7366;function hn(e){var t=e.toward.clone().sub(e.start).normalize().multiplyScalar(on*(e.numLeds-1+.1)).add(e.start);return function(e){var t=e.end.clone().sub(e.start),i=Math.max(0,t.length()-(e.shortenBy||0)-(e.skipFirst||0)),n=t.clone().normalize().multiplyScalar(e.spacing);return function(e){for(var t=[],i=e.firstPoint.clone(),n=0;n<e.numPoints;++n)t.push(i.clone()),i.add(e.step);return t}({firstPoint:e.start.clone().add(t.clone().normalize().multiplyScalar(e.skipFirst||0)),step:n,numPoints:1+Math.floor(i/e.spacing)})}({start:e.start,end:t,spacing:on})}function dn(e){var t="small"===e?cn:-1.4478000000000002,i="small"===e?.4953000000000001:1.2255500000000001,n="small"===e?ln:un;return Object(u.e)(4,(function(e){return hn({start:new $.wb(0,.19050000000000003*(3-e)),toward:new $.wb(t,i),numLeds:n[e]})}))}var vn=function(e){Object(s.a)(i,e);var t=Object(o.a)(i);function i(e){Object(a.a)(this,i);var n=function(){var e=function(e){return function(t){return t.map((function(t){return t.clone().add(e)}))}},t=dn("small").map(e(new $.wb(-.75565))),i=dn("large").map(e(new $.wb(-.8001))),n=Object(u.k)(t,i),a=function(e){return new $.wb(-1*e.x,e.y)},r=n.map((function(e){return e.map(a)}));return[].concat(Object(v.a)(n),Object(v.a)(r))}(),r=n.map((function(e){return e.length})),s=n.map((function(e){return Ji({points:e,bottomLeft:new $.xb(0,.8890000000000001,1.25),rightDirection:new $.xb(1,0,0),upDirection:new $.xb(0,1,0)})})),o=[];return s.forEach((function(e,t){var i=Math.floor(t%8/2);e.forEach((function(e,n){o.push({position:e,hardwareChannel:t+1,hardwareIndex:n,rowHint:i})}))})),t.call(this,Object(Le.a)(Object(Le.a)({},function(){var e=.7588250000000001,t=tn({keyboardInFront:!1,hideKeyboard:!0});return t.extraObjects.push(Qi({width:4*Yi,height:65*Yi,depth:4*Yi,translateBy:new $.xb(e,0,1.32)})),t.extraObjects.push(Qi({width:4*Yi,height:65*Yi,depth:4*Yi,translateBy:new $.xb(-1*e,0,1.32)})),t}()),{},{name:e,camera:{startPosition:new $.xb(0,1.4,-2.5),target:new $.xb(0,1.2,0)},leds:o,ledRadius:.007,initialDisplayValues:{l:JSON.stringify(r)},voronoiMaxDimension:200}))}return i}(sn);function fn(e,t,i,n,a){var r=new $.wb(0,0),s=(i?u.l:u.f)(e[t]);return e.map((function(e){return e.map((function(e){return e.clone().sub(s).rotateAround(r,a/180*Math.PI).add(n)}))}))}var pn=function(e){Object(s.a)(i,e);var t=Object(o.a)(i);function i(e){Object(a.a)(this,i);var n=function(){var e=fn(dn("small"),0,!0,new $.wb(.028575000000000003,1.4986000000000002),-124.2),t=fn(dn("large"),3,!1,new $.wb(.053975,1.0541),-90),i=Object(u.k)(e,t),n=function(e){return new $.wb(-1*e.x,e.y)},a=i.map((function(e){return e.map(n)}));return[].concat(Object(v.a)(i),Object(v.a)(a))}(),r=n.map((function(e){return e.length})),s=n.map((function(e){return Ji({points:e,bottomLeft:new $.xb(0,0,1.25),rightDirection:new $.xb(1,0,0),upDirection:new $.xb(0,1,0)})})),o=[];return s.forEach((function(e,t){var i=Math.floor(t%8/2);e.forEach((function(e,n){o.push({position:e,hardwareChannel:t+1,hardwareIndex:n,rowHint:i})}))})),t.call(this,Object(Le.a)(Object(Le.a)({},{extraObjects:[function(){return Qi({width:3.048,height:9*Xi,depth:.1524,translateBy:new $.xb(0,0,4.5*Xi),material:new $.L({color:197379,transparent:!0,side:$.l})})()}]}),{},{name:e,camera:{startPosition:new $.xb(0,1.4,-2.5),target:new $.xb(0,1.2,0)},leds:o,ledRadius:.007,initialDisplayValues:{l:JSON.stringify(r)},voronoiMaxDimension:130}))}return i}(sn);function mn(e,t){var i=t||0,n=[];return e.forEach((function(e,t){var a=e.numLeds,r=e.endPoint.clone();r.sub(e.startPoint),r.divideScalar(e.numLeds-1);for(var s=0;s<a;++s){var o=r.clone();o.multiplyScalar(s),o.add(e.startPoint);var l={position:o,hardwareChannel:e.hardwareChannel,hardwareIndex:s,rowHint:i+t};n.push(l)}})),n}var bn=function(e){Object(s.a)(i,e);var t=Object(o.a)(i);function i(e){return Object(a.a)(this,i),t.call(this,Object(Le.a)(Object(Le.a)({},tn({keyboardInFront:!0})),{},{name:e,camera:{startPosition:new $.xb(0,1.1,-1.5),target:new $.xb(0,.5,0)},leds:mn([{numLeds:88,startPoint:new $.xb(-.6,.74,-.163),endPoint:new $.xb(.6,.74,-.163),hardwareChannel:1},{numLeds:88,startPoint:new $.xb(-.6,.725,-.168),endPoint:new $.xb(.6,.725,-.168),hardwareChannel:2},{numLeds:88,startPoint:new $.xb(-.6,.71,-.173),endPoint:new $.xb(.6,.71,-.173),hardwareChannel:3}]),ledRadius:.0035,voronoiMaxDimension:150}))}return i}(sn),gn=new Map;[new bn("keyboard:3stripes"),new vn("burrow:wings30x4-real"),new pn("garage:wings30x4-real")].forEach((function(e){var t=e.name;if(gn.has(t))throw new Error("scene already registered with name: ".concat(t));gn.set(t,e)}));var wn=function(e){Object(s.a)(i,e);var t=Object(o.a)(i);function i(){return Object(a.a)(this,i),t.apply(this,arguments)}return Object(r.a)(i,[{key:"render",value:function(){return Object(zt.jsx)(Zi,{scenes:gn,visualizations:jt})}}]),i}(l.PureComponent);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));n.render(Object(zt.jsx)(wn,{}),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()}))},8:function(e,t,i){"use strict";i.d(t,"e",(function(){return s})),i.d(t,"p",(function(){return o})),i.d(t,"h",(function(){return l})),i.d(t,"b",(function(){return u})),i.d(t,"d",(function(){return c})),i.d(t,"c",(function(){return h})),i.d(t,"m",(function(){return d})),i.d(t,"o",(function(){return v})),i.d(t,"n",(function(){return f})),i.d(t,"i",(function(){return p})),i.d(t,"a",(function(){return m})),i.d(t,"q",(function(){return b})),i.d(t,"r",(function(){return g})),i.d(t,"f",(function(){return w})),i.d(t,"g",(function(){return y})),i.d(t,"j",(function(){return S})),i.d(t,"k",(function(){return O})),i.d(t,"l",(function(){return j}));var n=i(0),a=i(1),r=i(13);function s(e,t){for(var i=new Array(e),n=0;n<e;++n)i[n]=t(n);return i}function o(e,t){for(var i=0;i<e.length;++i)e[i]=t(e[i])}function l(e,t){if(0===t)return"".concat(Math.round(e));var i=Math.pow(10,t);e=Math.round(e*i)/i;var n="".concat(e).split("."),a=Object(r.a)(n,2),s=a[0],o=a[1];for(o=void 0===o?"":o.slice(0,t);o.length<t;)o+="0";return"".concat(s,".").concat(o)}function u(e,t,i){return i<e?e:i>t?t:i}function c(e,t){return function(i){return u(e,t,i)}}var h=c(0,1);function d(e,t){t.forEach((function(t){return e.push(t)}))}function v(e,t){for(var i=0;i<e.length;++i)if(e[i]===t)return void e.splice(i,1)}function f(e){e.splice(0,e.length)}function p(e,t){for(var i=e.length-1;i>=0;--i)t(e[i],i)}var m=function(){function e(t){Object(n.a)(this,e),this.values=void 0,this.numValues=0,this.sum=0,this.nextIndex=0,this.values=new Array(t)}return Object(a.a)(e,[{key:"movingAverage",get:function(){return this.sum/this.numValues}},{key:"addValue",value:function(e){this.numValues===this.values.length?this.sum-=this.values[this.nextIndex]:this.numValues++,this.values[this.nextIndex]=e,this.sum+=e,this.nextIndex=(this.nextIndex+1)%this.values.length}},{key:"addTiming",value:function(e){var t=performance.now();try{return e()}finally{this.addValue(performance.now()-t)}}},{key:"reset",value:function(){this.sum=0,this.nextIndex=0,this.numValues=0}}]),e}();function b(e,t){return void 0===e?t:e}function g(e){if(void 0===e)throw new Error("no value");return e}function w(e){var t=e[Symbol.iterator]().next();if(t.done)throw new Error("no value");return t.value}function y(e){return w(e.keys())}function S(e){return e}function O(e,t){if(e.length!==t.length)throw new Error("must be same length");var i=[];return e.forEach((function(e,n){i.push(e),i.push(t[n])})),i}function j(e){if(0===e.length)throw new Error("no items");return e[e.length-1]}}},[[62,1,2]]]);
//# sourceMappingURL=main.e24b8e25.chunk.js.map